Takahashi is locked within a building consisting of HÃ—W rooms, each represented by characters where '#' indicates a locked room and '.' and 'S' are freely enterable. Takahashi starts in room 'S' and can move to adjacent rooms up to K times and unlock up to K locked rooms in one cast. The goal is to reach a room with an exit, minimizing the number of casts required. The building has exits at the borders. Your task is to determine the minimum number of casts Takahashi needs to escape.
Ringo is interested in modern art and wants to paint a large board in a venue using a specific arrangement of people. The board consists of squares with dimensions (N+2) x (M+2), where squares at the edges are painted black, and squares inside are painted white. People are placed on the outer squares based on four input strings (A, B, C, and D) which determine their positions and directions. Each person will move and paint white squares until they encounter a non-white square. The task is to find the number of different final painted states of the board, modulo 998244353.
[
  {
    "language": "Scala",
    "code": "object Main extends App {\n  import scala.io.StdIn._\n  val Array(n, q, l, r) = readLine.trim.split(' ').map(_.toLong)\n  val number = readLine.trim.split(' ').map(_.toLong)\n  val queries = Array.fill(q.toInt){\n    val Array(q, x, s, t ) = readLine.trim.split(' ').map(_.toLong)\n    Query(q, x, s, t)\n  }\n  var lower = BigInt(l)\n  var upper = BigInt(r)\n  var range: Range = queries.foldRight(Section(l, r): Range){case (q, r) ⇒ r.reverse(q)}\n  println(number.count(range.contains))\n  case class Query(q: Long, x: Long, s: Long, t: Long)\n  sealed trait Range {\n    def contains(value: Long): Boolean\n    def contains(value: BigInt): Boolean\n    def split(value: BigInt): (Range, Range)\n    def takeUntil(value: BigInt): Range\n    def takeTo(value: BigInt): Range\n    def dropUntil(value: BigInt): Range\n    def dropTo(value: BigInt): Range\n    def +(that: Range): Range\n    def reverse(query: Query): Range\n  }\n  case object Empty extends Range {\n    override def contains(value: Long): Boolean = false\n    override def contains(value: BigInt): Boolean = false\n    override def split(value: BigInt): (Range, Range) = (Empty, Empty)\n    override def takeUntil(value: BigInt): Range = Empty\n    override def takeTo(value: BigInt): Range = Empty\n    override def dropUntil(value: BigInt): Range = Empty\n    override def dropTo(value: BigInt): Range = Empty\n    override def +(that: Range): Range = that\n    override def reverse(query: Query): Range = Empty\n  }\n  case class Section(from: BigInt, to: BigInt) extends Range {\n    override def contains(value: Long): Boolean = from <= value && value <= to\n    override def contains(value: BigInt): Boolean = from <= value && value <= to\n    override def split(value: BigInt): (Range, Range) = if (contains(value)) (Section(from, value), Section(value, to)) else if (value < from) (Empty, this) else (this, Empty)\n    override def takeUntil(value: BigInt): Range = if (value < from) Empty else Section(from, min(to, value - 1))\n    override def takeTo(value: BigInt): Range = if (value < from) Empty else Section(from, min(to, value))\n    override def dropUntil(value: BigInt): Range = if (to < value) Empty else Section(max(from, value), to)\n    override def dropTo(value: BigInt): Range = if (to < value) Empty else Section(max(from, value + 1), to)\n    override def +(that: Range): Range = that match {\n      case Empty ⇒ this\n      case Section(fromT, toT) ⇒Section(min(fromT, from), max(toT, to))\n    }\n    override def reverse(query: Query): Range = query match {\n      case Query(1, x, s, t) ⇒ takeUntil(x) + Section((from + t - 1) / t - s, to / t - s).dropUntil(x)\n      case Query(2, x, s, t) if to < 0 ⇒ Section(from * t + s + 1 - t, to * t + s).takeTo(x) + dropTo(x)\n      case Query(2, x, s, t) if contains(0) ⇒ Section(from * t + s + 1 - t, to * t + s + t - 1).takeTo(x) + dropTo(x)\n      case Query(2, x, s, t) ⇒ Section(from * t + s, to * t + s + t - 1).takeTo(x) + dropTo(x)\n      case _ ⇒ ???\n    }\n  }\n  def min[T: Ordering](a: T, b: T): T = if (implicitly[Ordering[T]].compare(a, b) <= 0) a else b\n  def max[T: Ordering](a: T, b: T): T = if (implicitly[Ordering[T]].compare(a, b) >= 0) a else b\n}\n"
  },
  {
    "language": "C++",
    "code": "// untiioiiiiiiiiiiiiiasaaa\n#include<bits/stdc++.h>\nusing namespace std;\n#define X first\n#define S second\n\n#define all(v) (v).begin(), (v).end()\n#define FOR(i,a,b) for(int i=(a);i<(b);++i)\n#define rep(i,b) FOR(i,0,b)\n#define reps FOR\n#define eb emplace_back\n#define pb eb\n\nusing LL = long long;\nusing pii = pair<int, int>;\n\nint N;\nint Q;\nLL L, R;\nvector<LL> as;\nLL cmd[214514][4];\n\nLL Eval(LL v) {\n  rep(i, Q) {\n    if (cmd[i][0] == 1) {\n      if (cmd[i][1] <= v) {\n        v = (v+cmd[i][2])*cmd[i][3];\n      }\n    } else if (cmd[i][0] == 2) {\n      if (cmd[i][1] >= v) {\n        v = (v-cmd[i][2])/cmd[i][3];\n      }\n    }\n  }\n  return v;\n}\n\nint main() {\n  cin >> N >> Q >> L >> R;\n  rep(i, N) {\n    LL a;\n    cin >> a;\n    as.eb(a);\n  }\n  sort(all(as));\n\n  rep(i, Q) {\n    rep(j, 4) {\n      cin >> cmd[i][j];\n    }\n  }\n\n  int ans = 0;\n  {\n    int low = -1;\n    int high = N;\n    while (high - low > 1) {\n      int mid = (high+low)/2;\n      LL res = Eval(as[mid]);\n      if (L > res) low = mid;\n      else high = mid;\n    }\n    ans -= low;\n  }\n  {\n    int low = -1;\n    int high = N;\n    while (high - low > 1) {\n      int mid = (high+low)/2;\n      LL res = Eval(as[mid]);\n      if (R >= res) low = mid;\n      else high = mid;\n    }\n    ans += low;\n  }\n  cout << ans << endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n\n#define pb push_back\n#define mp make_pair\n#define fi first\n#define se second\n\nusing namespace std;\n\ntypedef long long ll;\ntypedef unsigned long long ull;\ntypedef pair<int,int> pii;\ntypedef pair<ll,ll> pll;\n\ntemplate <typename T> bool chkmax(T &x,T y){return x<y?x=y,true:false;}\ntemplate <typename T> bool chkmin(T &x,T y){return x>y?x=y,true:false;}\n\nll readint(){\n\tll x=0,f=1; char ch=getchar();\n\twhile(ch<'0'||ch>'9'){if(ch=='-')f=-1;ch=getchar();}\n\twhile(ch>='0'&&ch<='9'){x=x*10+ch-'0';ch=getchar();}\n\treturn x*f;\n}\n\nconst ll inf=(1ull<<63)-1;\nll n,q,l,r;\nll a[200005],opt[200005],X[200005],S[200005],T[200005];\n\nint main(){\n\tn=readint(); q=readint(); l=readint(); r=readint();\n\tfor(int i=1;i<=n;i++) a[i]=readint();\n\tfor(int i=1;i<=q;i++){\n\t\topt[i]=readint(); X[i]=readint(); S[i]=readint(); T[i]=readint();\n\t}\n\tfor(int i=q;i>=1;i--){\n\t\tll s=S[i],t=T[i],x=X[i];\n\t\tif(opt[i]==1){\n\t\t\tll tl=l/t-s,tr=r/t-s;\n\t\t\tif(l>x) l=max(tl,x),r=max(tr,x-1);\n\t\t\telse if(r<x);\n\t\t\telse r=max(tr,x-1);\n\t\t}\n\t\telse{\n\t\t\tll tl,tr;\n\t\t\tif(l<0){\n\t\t\t\tif(-inf/(l-1)<=t) tl=-inf;\n\t\t\t\telse tl=t*(l-1)+s+1;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif((inf-s)/l<=t) tl=inf;\n\t\t\t\telse tl=t*l+s;\n\t\t\t}\n\t\t\tif(r<0){\n\t\t\t\tif(-inf/r<=t) tr=-inf;\n\t\t\t\telse tr=t*r+s;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tif((inf-s+1)/(r+1)<=t) tr=inf;\n\t\t\t\telse tr=t*(r+1)+s-1;\n\t\t\t}\n\t\t\tif(l>x);\n\t\t\telse if(r<x) l=min(tl,x+1),r=min(tr,x);\n\t\t\telse l=min(tl,x+1);\n\t\t}\n//\t\tcout<<\"test \"<<i<<' '<<l<<' '<<r<<endl;\n\t\tif(l>r) return printf(\"0\\n\"),0;\n\t}\n\tint cnt=0;\n//\tcout<<\"end \"<<l<<' '<<r<<endl;\n//\tfor(int i=1;i<=n;i++) cout<<a[i]<<' ';\n//\tcout<<endl;\n\tfor(int i=1;i<=n;i++) if(l<=a[i]&&a[i]<=r) cnt++;\n\tprintf(\"%d\\n\",cnt);\n\treturn 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "\n#ifdef _MSC_VER\n#define _CRT_SECURE_NO_WARNINGS\n#endif\n#include <iostream>\n#include <fstream>\n#include <string>\n#include <vector>\n#include <map>\n#include <set>\n#include <unordered_map>\n#include <unordered_set>\n#include <queue>\n#include <stack>\n#include <array>\n#include <deque>\n#include <algorithm>\n#include <utility>\n#include <cstdint>\n#include <functional>\n#include <iomanip>\n#include <numeric>\n#include <assert.h>\n#include <bitset>\n#include <list>\n#include <cmath>\n\nusing std::cout;\nusing std::cin;\nusing std::endl;\n\n\n#define __int128 int64_t\n\n__int128 A[200100];\nint qtype[200100];\n__int128 qx[200100];\n__int128 qs[200100];\n__int128 qt[200100];\n\nconst int64_t INF = 2000000000;\nconst int64_t INFINF = (((uint64_t)(1) << 63) - 1);\n\nint main()\n{\n\n\tint N, Q;\n\t__int128 L, R;\n\n\tcin >> N >> Q >> L >> R;\n\n\tfor (int i = 0; i < N; ++i) {\n\t\tcin >> A[i];\n\t}\n\n\tfor (int i = 0; i < Q; ++i) {\n\t\tcin >> qtype[i] >> qx[i] >> qs[i] >> qt[i];\n\t}\n\n\t//L以上になる条件\n\tint64_t ok_range = INF, ng_range = -INF;\n\twhile (std::abs(ok_range - ng_range) > 1) {\n\t\tauto mid = (ok_range + ng_range) / 2;\n\n\t\tauto nowpos = mid;\n\t\tfor (int i = 0; i < Q; ++i) {\n\t\t\tif (qtype[i] == 1) {\n\t\t\t\tif (qx[i] <= nowpos) {\n\t\t\t\t\tnowpos = qt[i] * (nowpos + qs[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (nowpos <= qx[i]) {\n\t\t\t\t\tnowpos = (nowpos - qs[i])/ qt[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (L <= nowpos) {\n\t\t\tok_range = mid;\n\t\t}\n\t\telse {\n\t\t\tng_range = mid;\n\t\t}\n\t}\n\tauto LLL = ok_range;\n\n\t//R以下になる条件\n\tok_range = -INF, ng_range = INF;\n\twhile (std::abs(ok_range - ng_range) > 1) {\n\t\tauto mid = (ok_range + ng_range) / 2;\n\n\t\tauto nowpos = mid;\n\t\tfor (int i = 0; i < Q; ++i) {\n\t\t\tif (qtype[i] == 1) {\n\t\t\t\tif (qx[i] <= nowpos) {\n\t\t\t\t\tnowpos = qt[i] * (nowpos + qs[i]);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif (nowpos <= qx[i]) {\n\t\t\t\t\tnowpos = (nowpos - qs[i]) / qt[i];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (nowpos <= R) {\n\t\t\tok_range = mid;\n\t\t}\n\t\telse {\n\t\t\tng_range = mid;\n\t\t}\n\t}\n\tauto RRR = ok_range;\n\n\tint count = 0;\n\tfor (int i = 0; i < N; ++i) {\n\t\tif (LLL <= A[i] && A[i] <= RRR) {\n\t\t\t++count;\n\t\t}\n\t}\n\tcout << count << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n#define r(i,n) for(int i=0;i<n;i++)\nusing namespace std;\n#define int long long\n\nint n,m,L,R,s[200009],t[200009];\nint a[200009],x[200009];\nint query[200009];\n\nbool ch1(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  return R<A;\n}\n\nbool ch2(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  return L<=A;\n}\n\nvoid ch3(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  cout<<A<<endl;\n}\n\nsigned main(){\n  cin>>n>>m>>L>>R;\n  r(i,n)cin>>a[i];\n  r(i,m){\n    cin>>query[i]>>x[i]>>s[i]>>t[i];\n  }\n  //cout<<endl;\n  sort(a,a+n);\n\n  //r(i,n)ch3(i);\n\n  int l=-1,r=n;\n  while(r-l>1){\n    int mid=(r+l)/2;\n    if(ch1(mid))r=mid;\n    else l=mid;\n  }\n\n  int l2=-1,r2=n;\n  while(r2-l2>1){\n    int mid=(r2+l2)/2;\n    //cout<<r2<<l2<<mid<<endl;\n    if(ch2(mid))r2=mid;\n    else l2=mid;\n    //cout<<r2<<l2<<mid<<endl;\n  }\n  //cout<<r<<' '<<r2<<endl;\n\n  cout<<r-r2<<endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <iostream>\n#include <vector>\n#include <algorithm>\n#define rep(i, a) for (int i = 0; i < (a); i++)\n#define int long long\nusing namespace std;\n\nstruct Q {\n\tint q, x, s, t;\n};\n\nint q, r, l;\nvector<int> a;\nvector<Q> que;\n\nint cal(int mid){\n\tint cur = a[mid];\n\trep(i,q){\n\t\tif(que[i].q == 1){\n\t\t\tif(cur >= que[i].x){\n\t\t\t\tcur = (cur + que[i].s) * que[i].t;\n\t\t\t}\n\t\t}else{\n\t\t\tif(cur <= que[i].x){\n\t\t\t\tcur = (cur - que[i].s) / que[i].t;\n\t\t\t}\n\t\t}\n\t}\n\treturn cur;\n}\n\nbool isOk_max(int mid) {\n\tint cur = a[mid];\n\trep(i,q){\n\t\tif(que[i].q == 1){\n\t\t\tif(cur >= que[i].x){\n\t\t\t\tcur = (cur + que[i].s) * que[i].t;\n\t\t\t}\n\t\t}else{\n\t\t\tif(cur <= que[i].x){\n\t\t\t\tcur = (cur - que[i].s) / que[i].t;\n\t\t\t}\n\t\t}\n\t}\n\treturn cur < r;\n}\nbool isOk_min(int mid) {\n\tint cur = a[mid];\n\trep(i,q){\n\t\tif(que[i].q == 1){\n\t\t\tif(cur >= que[i].x){\n\t\t\t\tcur = (cur + que[i].s) * que[i].t;\n\t\t\t}\n\t\t}else{\n\t\t\tif(cur <= que[i].x){\n\t\t\t\tcur = (cur - que[i].s) / que[i].t;\n\t\t\t}\n\t\t}\n\t}\n\treturn cur > l;\n}\n\nsigned main() {\n\tint n;\n\tcin >> n >> q >> l >> r;\n\tr++;\n\tl--;\n\n\ta = vector<int>(n);\n\trep(i, n) cin >> a[i];\n\tsort(a.begin(), a.end());\n\n\tque = vector<Q>(q);\n\trep(i, q) {\n\t\tint a, b, c, d;\n\t\tcin >> a >> b >> c >> d;\n\t\tque[i] = {a, b, c, d};\n\t}\n\n\t// 上限を探す\n\tint ok = -1, ng = n;\n\trep(i, 100) {\n\t\tint mid = (ok + ng) / 2;\n\t\tif (isOk_max(mid))\n\t\t\tok = mid;\n\t\telse\n\t\t\tng = mid;\n\t}\n\n\tint maxi = ok;\n\n\tok = n, ng = -1;\n\trep(i,100){\n\t\tint mid = (ok + ng) / 2;\n\t\tif (isOk_min(mid))\n\t\t\tok = mid;\n\t\telse\n\t\t\tng = mid;\n\t}\n\n\t//rep(i,n){ cout << cal(i) << ' '; } cout << endl;\n\n\tcout << maxi - ok + 1 << endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <cstdio>\n#include <algorithm>\n\nconst int maxn=2e5+5;\n#define int long long\nstruct question{\n\tint opt,x,s,t;\n}q[maxn];\n\nint n,Q,L,R,a[maxn];\n\n#define F_L 1\n#define F_R 0\n\ninline bool check(int x,bool flag){\n\tfor(int i=1;i<=Q;i++){\n\t\tif(q[i].opt==1){\n\t\t\tif(x>=q[i].x){\n\t\t\tx+=q[i].s;x*=q[i].t;}\n\t\t}else{\n\t\t\tif(x<=q[i].x){\n\t\t\tx-=q[i].s;x/=q[i].t;}\n\t\t}\n\t}\n\t//printf(\"%d\\n\",x);\n\tif(flag){\n\t\treturn x>=L;\n\t}return x<=R;\n}\n\nsigned main(){\n\tscanf(\"%lld%lld%lld%lld\",&n,&Q,&L,&R);\n\tfor(int i=1;i<=n;i++) scanf(\"%lld\",&a[i]);\n\tstd::sort(a+1,a+n+1);\n\tfor(int i=1;i<=Q;i++) scanf(\"%lld%lld%lld%lld\",&q[i].opt,&q[i].x,&q[i].s,&q[i].t);\n\tint l=1,r=n,mid,res=0;\n\twhile(l<=r){\n\t\tmid=(l+r)>>1;\n\t\tint now=a[mid];\n\t\tif(check(now,F_L)){\n\t\t\tr=mid-1;\n\t\t\tres=mid;\n\t\t}else l=mid+1;\n\t\t//printf(\"%d\\n\",mid);\n\t}int ansl=res;\n\tl=1,r=n,res=0;//printf(\"------------------\\n\");\n\twhile(l<=r){\n\t\tmid=(l+r)>>1;\n\t\tint now=a[mid];\n\t\tif(check(now,F_R)){\n\t\t\tl=mid+1;\n\t\t\tres=mid;\n\t\t}else r=mid-1;\n\t\t//printf(\"%d\\n\",mid);\n\t}\n\t//printf(\"%lld %lld\\n\",ansl,res);\n\tprintf(\"%lld\\n\",res-ansl+1);\n\treturn 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<vector>\n#include<iostream>\n#include<string>\n#include<algorithm>\n#include<math.h>\n#include<map>\n#include<functional>\n#include<queue>\n#include<stack>\n#include<string.h>\n#include<list>\n#include<limits>\n#include<bitset>\n#include<ctype.h>\n#include<set>\n#define all(vec) vec.begin(),vec.end()\nusing namespace std;\nusing ll=long long;\nusing P=pair<ll,ll>;\nint q;\nvector<ll> qs,x,s,t;\nll f(ll b){\n    for(int i=0;i<q;i++){\n            if(qs[i]==1){\n                if(b>=x[i]){\n                    b+=s[i];\n                    b*=t[i];\n                }\n            }else{\n                if(b<=x[i]){\n                    b-=s[i];\n                    b/=t[i];\n                }\n            }\n        }\n    return b;\n}\nint main() {\n    cin.tie(0);\n    ios::sync_with_stdio(false);\n    ll n,l,r;cin>>n>>q>>l>>r;\n    vector<ll> a(n);\n    for(int i=0;i<n;i++){\n        cin>>a[i];\n    }\n    sort(all(a));\n    qs.resize(q);\n    x.resize(q);\n    s.resize(q);\n    t.resize(q);\n    for(int i=0;i<q;i++){\n        cin>>qs[i]>>x[i]>>s[i]>>t[i];\n    }\n    int ok=0,ng=n;\n    while(ng-ok>1){\n        int mid=(ok+ng)/2;\n        if(f(a[mid])<l){\n            ok=mid;\n        }else{\n            ng=mid;\n        }\n    }\n    int lb=ok;\n    if(f(a[lb])>=l){\n        --lb;\n    }\n    ok=0,ng=n;\n    while(ng-ok>1){\n        int mid=(ok+ng)/2;\n        if(f(a[mid])<=r){\n            ok=mid;\n        }else{\n            ng=mid;\n        }\n    }\n    int rb=ok;\n    if(f(a[rb])>r){\n        --rb;\n    }\n    cout<<(rb-lb)<<endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<iostream>\n#include<string>\n#include<vector>\n#include<algorithm>\n\nusing namespace std;\n\n#define int long long\n\n#define q first.first\n#define x first.second\n#define s second.first\n#define t second.second\n\nvector<int> A, B;\nvector<pair<pair<int,int>,pair<int,int>>> query;\nint N, Q, L, R;\n\nint check(int num){\n\tif(num < 0) return (int)(1ull<<63);\n\tif(num >= N) return (int)(~(1ull<<63));\n\t\n\tint v = A[num];\n\t\n\tfor(int i = 0; i < Q; i++){\n\t\tif(query[i].q == 1){\n\t\t\tif(query[i].x <= v){\n\t\t\t\tv = query[i].t*(query[i].s+v);\n\t\t\t}\n\t\t} else if(query[i].q == 2){\n\t\t\tif(query[i].x >= v){\n\t\t\t\tv = (v-query[i].s)/query[i].t;\n\t\t\t}\n\t\t\t\n\t\t}\n\t\t// cout<<\"v = \"<<v<<endl;\n\t}\n\t\n\treturn v;\n}\n\nsigned main(){\n\n\tint al, ar;\n\t// cout<<(int)(1ull<<63)<<endl;\n\t// cout<<(int)(~(1ull<<63))<<endl;\n\t// cout<<(int)(-2.8)<<endl;\n\t// cout<<(int)(-3/2)<<endl;\n\t\n\tcin>>N>>Q>>L>>R;\n\t\n\tA.assign(N, 0);\n\tquery.assign(Q, {});\n\t\n\tfor(int i = 0; i < N; i++){\n\t\tcin>>A[i];\n\t}\n\t\n\tB = A;\n\t\n\tsort(A.begin(), A.end());\n\tA.erase(unique(A.begin(), A.end()), A.end());\n\t\n\t// for(){\n\t// }\n\tfor(int i = 0; i < Q; i++){\n\t\t\n\t\tcin>>query[i].q>>query[i].x>>query[i].s>>query[i].t;\n\t}\n\t\n\t// for(int i = 0; i < N; i++){\n\t\t// cout<<\"i = \"<<i<<\" \"<<check(i)<<endl;\n\t// }\n\tN = A.size();\n\t\n\tint l = -1, r = N+1, m;\n\t\n\twhile(l + 1 < r){\n\t\tm = (l+r)/2;\n\t\t\n\t\t// cout<<l<<\" \"<<m<<\" \"<<r<<endl;\n\t\t// string hogehoge;\n\t\t// cin>>hogehoge;\n\t\t\n\t\tif(check(m) > R){\n\t\t\tr = m;\n\t\t} else {\n\t\t\tl = m;\n\t\t}\n\t}\n\t\n\tar = l;\n\t\n\tl = -1, r = N+1, m;\n\t\n\twhile(l + 1 < r){\n\t\tm = (l+r)/2;\n\t\t\n\t\tif(check(m) >= L){\n\t\t\tr = m;\n\t\t} else {\n\t\t\tl = m;\n\t\t}\n\t}\n\t\n\tal = r;\n\t\n\t// cout<<ar-al<<endl;\n\t\n\tint con = 0;\n\t\n\t//cout<<\"N = \"<<N<<endl;\n\tfor(int i = 0; i < B.size(); i++){// cout<<i<<endl;\n\t\t//cout<<ar<<\" \"<<al<<endl;\n\t\t\n\t\tif(ar == -1 || al == N){ //cout<<\"D\"<<endl;\n\t\t} else if(ar == N && al == -1){ cout<<\"A\"<<endl;\n\t\t\tcon++;\n\t\t} else if(A[al] <= B[i] && ar == N){ //cout<<\"B\"<<endl;\n\t\t\tcon++;\n\t\t} else if(al == -1 && B[i] <= A[ar]){ //cout<<\"C\"<<endl;\n\t\t\tcon++;\n\t\t} else if(A[al] <= B[i] && B[i] <= A[ar]){\n\t\t\t//cout<<A[al]<<\" <= \"<<B[i]<<\" <= \"<<A[ar]<<endl;\n\t\t\tcon++;\n\t\t} else {\n\t\t\t//cout<<\"E\"<<endl;\n\t\t\t//cout<<A[al]<<\" <= \"<<B[i]<<\" <= \"<<A[ar]<<endl;\n\t\t}\n\t}\n\tcout<<con<<endl;\n\treturn 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<iostream>\n#include<vector>\n#include<algorithm>\n#include<utility>\nusing namespace std;\n#define rep(i,n) for(int i=0;i<(int)(n);i++)\n#define int long long\ntypedef long long ll;\n\n\nint N, Q,_L,_R;\nvector<int> a;\nvector<__int128_t> x;\nvector<__int128_t> s;\nvector<__int128_t> t;\n__int128_t B;\n__int128_t calc(__int128_t X){\n    for(int i=0;i<Q;i++){\n        if(a[i] == 1)\n        {\n            if(X >= x[i]){\n                X = (X + s[i]) * t[i];\n            }\n        }else{\n            if(X <= x[i]){\n                X = (X - s[i]) / t[i];\n            }\n        }\n        X = min(X, B);\n        X = max(X, -B);\n    }\n    return X;\n}\n\nsigned main(){\n\n\n    //cerr << (int) ( (__int128_t)-5 / 3) << endl;\n\n    cin >> N >> Q >> _L >> _R;\n    __int128_t L, R;\n    L = _L;\n    R = _R;\n    vector<__int128_t> A(N);\n\n    for(int i=0;i<N;i++){\n        int a;\n        cin >> a;\n        A[i] = a;\n    }    \n    sort(A.begin(),A.end());\n    a.resize(Q);\n    x.resize(Q);\n    s.resize(Q);\n    t.resize(Q);\n    for(int i=0;i<Q;i++){\n        int _x,_s,_t;\n        cin >> a[i] >> _x >> _s >> _t;\n        x[i] = _x;\n        s[i] = _s;\n        t[i] = _t;\n    }\n\n    B = ((int)1 << 62);\n    B *= 4;\n    //cerr << (int)(B / 8) << endl; \n    __int128_t lo, hi;\n\n    lo = (__int128_t)-1e10;\n    hi = (__int128_t)1e10;\n\n    while(hi - lo > 1){\n        __int128_t m = (hi + lo) / 2;\n        __int128_t t = calc(m);\n        if(t >= L){\n            hi = m;\n        }else{\n            lo = m;\n        }\n    }\n\n    __int128_t LL = hi;\n\n    \n    lo = (__int128_t)-1e10;\n    hi = (__int128_t)1e10;\n\n    while(hi - lo > 1){\n        __int128_t m = (hi + lo) / 2;\n        __int128_t t = calc(m);\n\n        //cerr << (int)m << \" \" << (int)t << \" \" << (int)R << endl;\n        if(t <= R){\n            lo = m;\n        }else{\n          //  cerr << \"A\"<<endl;\n            hi = m;\n        }\n    }\n\n    __int128_t RR = lo;\n    //cerr << (int)LL <<\" \" << (int)RR << endl;\n    int res = upper_bound(A.begin(), A.end(), RR) - lower_bound(A.begin(), A.end(), LL);\n    cout << res << endl;\n    \n    return 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n\nstruct query{\n    long long q,x,s,t;\n};\n\nll N, Q, L, R;\nvector<long long> A;\nvector<query> queries;\n\nlong long solve();\nlong long calc(long long now);\n\nint main(){\n    cin >> N >> Q >> L >> R;\n    A.resize(N);\n    for(int i = 0;i < N;++i)cin >> A[i];\n    queries.resize(Q);\n    for(int i = 0;i < Q;++i)\n        cin >> queries[i].q >> queries[i].x >> queries[i].s >> queries[i].t;\n    cout << solve() << endl;\n    return 0;\n}\n\nlong long solve(){\n    sort(A.begin(),A.end());\n    long long l = 0,r = N - 1,ansl = 0,ansr = N-1;\n    if(L <= calc(A[0]))r = 0;\n    else if(calc(A[N-1]) < L)return 0;\n    else\n        while(r - l > 1){\n            long long now = (l + r)/2,nowans = 0;\n            nowans = calc(A[now]);\n            if(L <= nowans)r = now;\n            else l = now;\n        }\n    ansl = r;\n    l = 0;\n    r = N-1;\n    if(R >= calc(A[N-1]))l = N-1;\n    else if(calc(A[0]) > R)return 0;\n    else\n        while(r - l > 1){\n            long long now = (l + r)/2,nowans = 0;\n            nowans = calc(A[now]);\n            if(R >= nowans)l = now;\n            else r = now;\n        }\n        ansr = l;\n    return ansr - ansl + 1;\n}\n\nlong long calc(long long now){\n    for(int i = 0;i < Q;++i){\n        long long x = queries[i].x,s = queries[i].s,t = queries[i].t;\n        if(queries[i].q == 1){\n            if(x <= now)now = (now + s) * t;\n        }\n        else{\n            if(x >= now)now = (now - s) / t;\n        }\n    }\n    return now;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\nusing ll = long long int;\n\nstruct Query{\n    int type;\n    long long int x,s,t;\n    Query(const int ty,const long long int xx,const long long int ss,const long long int tt){\n        type=ty;\n        x=xx,s=ss,t=tt;\n    }\n};\n\nint main() {\n    int N,Q;\n    long long int L,R;\n    cin>>N>>Q>>L>>R;\n    vector<long long int>v(N);\n    for(auto &i:v)cin>>i;\n    //v.push_back(1LL<<63);\n    //cout<<(1LL<<63)<<endl;\n    sort(v.begin(),v.end());\n    vector<Query>q;\n    for(int i=0;i<Q;i++){\n        long long int a,b,c,d;\n        cin>>a>>b>>c>>d;\n        q.push_back(Query(a,b,c,d));\n    }\n    //cout<<\"hoge\"<<endl;\n    int Lindex=0;\n    int l=-1,r=v.size();\n    while(r-l>1){\n        int mid=(l+r)/2;\n       //cout<<l<<\" \"<<r<<endl;\n        long long int num=v[mid];\n        for(auto i:q){\n                if(i.type==1){\n                    if(i.x<=num){\n                        num+=i.s;\n                        num*=i.t;\n                    }\n                }\n                else {\n                    if(i.x>=num){\n                        num-=i.s;\n                        if(num)num=(abs(num)/i.t)*(num/abs(num));\n                    }\n                }\n        }\n        if(num>=L)r=mid;\n        else l=mid;\n    }\n    Lindex=l;\n    l=-1,r=v.size();\n    int Rindex=0;\n    while(r-l>1){\n        int mid=(l+r)/2;\n        long long int num=v[mid];\n        for(auto i:q){\n                if(i.type==1){\n                    if(i.x<=num){\n                        num+=i.s;\n                        num*=i.t;\n                    }\n                }\n                else {\n                    if(i.x>=num){\n                        num-=i.s;\n                        if(num)num=(abs(num)/i.t)*(num/abs(num));\n                    }\n                }\n        }\n        //cout<<mid<<\" \"<<num<<endl;\n        if(num>R)r=mid;\n        else l=mid;\n    }\n    Rindex=l;\n    //cout<<Rindex<<\" \"<<Lindex<<endl;\n    cout<<Rindex-Lindex<<endl;\n    return 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <iostream>\n#include <algorithm>\n#include <vector>\n\nusing Int = long long;\nusing std::vector;\n\nstruct Query {\n    int q;\n    Int x, s, t;\n    Query() {}\n};\n\nint main() {\n    int n, q;\n    Int l, r;\n    std::cin >> n >> q >> l >> r;\n\n    vector<Int> a(n);\n    for (auto& x : a) std::cin >> x;\n    std::sort(a.begin(), a.end());\n\n    vector<Query> queries(q);\n    for (auto& t : queries) {\n        std::cin >> t.q >> t.x >> t.s >> t.t;\n    }\n\n    auto eval = [&](Int x) {\n        for (auto t : queries) {\n            if (t.q == 1) {\n                if (x < t.x) continue;\n                x += t.s;\n                x *= t.t;\n            } else {\n                if (x > t.x) continue;\n                x -= t.s;\n                bool neg = (x < 0);\n                x = std::abs(x);\n                x /= t.t;\n                if (neg) x = -x;\n            }\n        }\n        return x;\n    };\n\n    int li;\n    {\n        int ok = n, ng = -1;\n        // eval(A_ok) >= L\n        while (ok - ng > 1) {\n            int mid = (ok + ng) / 2;\n            (eval(a[mid]) >= l ? ok : ng) = mid;\n        }\n        li = ok;\n    }\n\n    int ri;\n    {\n        int ok = -1, ng = n;\n        // eval(A_ok) <= R\n        while (ng - ok > 1) {\n            int mid = (ok + ng) / 2;\n            (eval(a[mid]) <= r ? ok : ng) = mid;\n        }\n        ri = ok;\n    }\n\n    std::cout << ri - li + 1 << std::endl;\n    return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n\nusing namespace std;\nusing Long = __int128_t;\n\nint main() {\n    ios::sync_with_stdio(false);\n    cin.tie(0);\n\n    int n, q;\n    long long l, r;\n    cin >> n >> q >> l >> r;\n    vector<int> as(n);\n    for (int i = 0; i < n; i++) cin >> as[i];\n\n    vector<long long> qs(q), xs(q), ss(q), ts(q);\n    for (int i = 0; i < q; i++) {\n        cin >> qs[i] >> xs[i] >> ss[i] >> ts[i];\n    }\n\n    Long lmima = -((Long) 1 << 64), lijou = (Long) 1 << 64;\n    while (lmima < lijou - 1) {\n        Long m = (lmima + lijou) / 2;\n        Long v = m;\n        for (int i = 0; i < q; i++) {\n            if (qs[i] == 1) {\n                if (v >= xs[i]) {\n                    v = ts[i] * (v + ss[i]);\n                }\n            } else {\n                if (v <= xs[i]) {\n                    v = (v - ss[i]) / ts[i];\n                }\n            }\n        }\n        if (v >= l) {\n            lijou = m;\n        } else {\n            lmima = m;\n        }\n    }\n\n    Long rika = -((Long) 1 << 64), rue = (Long) 1 << 64;\n    while (rika < rue - 1) {\n        Long m = (rika + rue) / 2;\n        Long v = m;\n        for (int i = 0; i < q; i++) {\n            if (qs[i] == 1) {\n                if (v >= xs[i]) {\n                    v = ts[i] * (v + ss[i]);\n                }\n            } else {\n                if (v <= xs[i]) {\n                    v = (v - ss[i]) / ts[i];\n                }\n            }\n        }\n        if (v <= r) {\n            rika = m;\n        } else {\n            rue = m;\n        }\n    }\n\n    int cnt = 0;\n    for (int i = 0; i < n; i++) {\n        if (as[i] >= lijou && as[i] <= rika) cnt++;\n    }\n    cout << cnt << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nll N, Q, L, R;\nll A[200500];\nll q[205000], x[200500], s[200050], t[200050];\n\nll f(ll now) {\n    for(int i = 1; i <= Q; i++) {\n        if(q[i] == 1) {\n            if(now >= x[i]) {\n                now = t[i] * (now + s[i]);\n            }\n        } else {\n            if(now <= x[i]) {\n                now = (now - s[i]) / t[i];\n            }\n        }\n    }\n    return now;\n}\n\nint main() {\n    cin >> N >> Q >> L >> R;\n    for(int i = 1; i <= N; i++) cin >> A[i];\n    for(int i = 1; i <= Q; i++) {\n        cin >> q[i] >> x[i] >> s[i] >> t[i];\n    }\n    ll overok = 1e9+1;\n    ll overng = -1e9-1;\n    ll underok = -1e9-1;\n    ll underng = 1e9+1;\n    while(overok - overng > 1) {\n        ll mid = (overok + overng) / 2;\n        ll tmp = f(mid);\n        if(tmp > R) overok = mid;\n        else overng = mid;\n    }\n    while(underng - underok > 1) {\n        ll mid = (underok + underng) / 2;\n        ll tmp = f(mid);\n        if(tmp < L) underok = mid;\n        else underng = mid;\n    }\n    //cerr << overok << \" \" << underok << endl;\n//    cerr << f(overok) << \" \" << f(overng) << endl;\n//    cerr << f(underok) << \" \" << f(underng) << endl;\n    ll ans = 0;\n    for(int i = 1; i <= N; i++) {\n        if(A[i] < overok && A[i] > underok) {\n            ans++;\n            //cerr << i << endl;\n        }\n        //cerr << f(A[i]) << endl;\n    }\n    cout << ans << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <iostream>\n#include <algorithm>\n#define llint long long\n\nusing namespace std;\n\nllint n, Q, L, R;\nllint a[200005];\nllint q[200005], x[200005], s[200005], t[200005];\n\nbool check(llint m)\n{\n\tif(m >= n) return true;\n\tm = a[m];\n\tfor(int i = 0; i < Q; i++){\n\t\tif(q[i] == 1){\n\t\t\tif(m >= x[i]) m = (m+s[i])*t[i];\n\t\t}\n\t\telse{\n\t\t\tif(m <= x[i]) m = (m-s[i])/t[i];\n\t\t}\n\t}\n\treturn m >= R;\n}\n\nbool check2(llint m)\n{\n\tif(m < 0) return true;\n\tm = a[m];\n\tfor(int i = 0; i < Q; i++){\n\t\tif(q[i] == 1){\n\t\t\tif(m >= x[i]) m = (m+s[i])*t[i];\n\t\t}\n\t\telse{\n\t\t\tif(m <= x[i]) m = (m-s[i])/t[i];\n\t\t}\n\t}\n\treturn m <= L;\n}\n\nint main(void)\n{\n\tios::sync_with_stdio(0);\n\tcin.tie(0);\n\t\n\tcin >> n >> Q >> L >> R;\n\tL--, R++;\n\tfor(int i = 0; i < n; i++) cin >> a[i];\n\tsort(a, a+n);\n\tfor(int i = 0; i < Q; i++) cin >> q[i] >> x[i] >> s[i] >> t[i];\n\t\n\tllint ub = n, lb = -1, mid, ans = 0;\n\twhile(ub-lb>1){\n\t\tmid = (ub+lb)/2;\n\t\tif(check(mid)) ub = mid;\n\t\telse lb = mid;\n\t}\n\tans += n - ub;\n\t\n\t//cout << ub << endl;\n\t\n\tub = n, lb = -1;\n\twhile(ub-lb>1){\n\t\tmid = (ub+lb)/2;\n\t\tif(check2(mid)) lb = mid;\n\t\telse ub = mid;\n\t}\n\tans += lb+1;\n\t\n\t//cout << lb << endl;\n\t\n\tcout << n - ans << endl;\n\t\n\treturn 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\n\nusing Int = long long;\nusing ll = long long;\n\ntemplate<typename T1,typename T2> inline void chmin(T1 &a,T2 b){if(a>b) a=b;};\ntemplate<typename T1,typename T2> inline void chmax(T1 &a,T2 b){if(a<b) a=b;};\n\ntemplate<typename T> void drop(T x){cout<<x<<endl;exit(0);}\n\n\nsigned main(){\n  cin.tie(0);\n  ios::sync_with_stdio(0);\n\n  Int n,q,l,r;\n  cin>>n>>q>>l>>r;\n  vector<Int> as(n);\n  for(Int i=0;i<n;i++) cin>>as[i];\n\n  vector<Int> qs(q),xs(q),ss(q),ts(q);\n  for(Int i=0;i<q;i++) cin>>qs[i]>>xs[i]>>ss[i]>>ts[i];\n\n  sort(as.begin(),as.end());\n\n  // number of elements whose value is no more than d\n  auto calc=\n    [&](Int d)->Int{\n      auto check=\n        [&](Int a)->Int{\n          for(Int i=0;i<q;i++){\n            if(qs[i]==1){\n              if(a>=xs[i]) a=ts[i]*(a+ss[i]);\n            }else{\n              if(a<=xs[i]) a=(a-ss[i])/ts[i];\n            }\n          }\n          return a<=d;\n        };\n      Int L=-1,R=n;\n      while(L+1<R){\n        Int M=(L+R)>>1;\n        if(check(as[M])) L=M;\n        else R=M;\n      }\n      return R;\n    };\n  Int ans=calc(r)-(l==LLONG_MIN?0:calc(l-1));\n  cout<<ans<<endl;\n  return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n\nusing namespace std;\n\nusing int64 = long long;\nconst int mod = 1e9 + 7;\n\nconst int64 infll = (1LL << 62) - 1;\nconst int inf = (1 << 30) - 1;\n\nstruct IoSetup {\n  IoSetup() {\n    cin.tie(nullptr);\n    ios::sync_with_stdio(false);\n    cout << fixed << setprecision(10);\n    cerr << fixed << setprecision(10);\n  }\n} iosetup;\n\n\ntemplate< typename T1, typename T2 >\nostream &operator<<(ostream &os, const pair< T1, T2 > &p) {\n  os << p.first << \" \" << p.second;\n  return os;\n}\n\ntemplate< typename T1, typename T2 >\nistream &operator>>(istream &is, pair< T1, T2 > &p) {\n  is >> p.first >> p.second;\n  return is;\n}\n\ntemplate< typename T >\nostream &operator<<(ostream &os, const vector< T > &v) {\n  for(int i = 0; i < (int) v.size(); i++) {\n    os << v[i] << (i + 1 != v.size() ? \" \" : \"\");\n  }\n  return os;\n}\n\ntemplate< typename T >\nistream &operator>>(istream &is, vector< T > &v) {\n  for(T &in : v) is >> in;\n  return is;\n}\n\ntemplate< typename T1, typename T2 >\ninline bool chmax(T1 &a, T2 b) { return a < b && (a = b, true); }\n\ntemplate< typename T1, typename T2 >\ninline bool chmin(T1 &a, T2 b) { return a > b && (a = b, true); }\n\ntemplate< typename T = int64 >\nvector< T > make_v(size_t a) {\n  return vector< T >(a);\n}\n\ntemplate< typename T, typename... Ts >\nauto make_v(size_t a, Ts... ts) {\n  return vector< decltype(make_v< T >(ts...)) >(a, make_v< T >(ts...));\n}\n\ntemplate< typename T, typename V >\ntypename enable_if< is_class< T >::value == 0 >::type fill_v(T &t, const V &v) {\n  t = v;\n}\n\ntemplate< typename T, typename V >\ntypename enable_if< is_class< T >::value != 0 >::type fill_v(T &t, const V &v) {\n  for(auto &e : t) fill_v(e, v);\n}\n\ntemplate< typename F >\nstruct FixPoint : F {\n  FixPoint(F &&f) : F(forward< F >(f)) {}\n\n  template< typename... Args >\n  decltype(auto) operator()(Args &&... args) const {\n    return F::operator()(*this, forward< Args >(args)...);\n  }\n};\n\ntemplate< typename F >\ninline decltype(auto) MFP(F &&f) {\n  return FixPoint< F >{forward< F >(f)};\n}\n\n\nint main() {\n  int N, Q;\n  int64 L, R;\n  cin >> N >> Q >> L >> R;\n  vector< int64 > A(N);\n  cin >> A;\n  sort(begin(A), end(A));\n  vector< int64 > a(Q), b(Q), c(Q), d(Q);\n  for(int i = 0; i < Q; i++) {\n    cin >> a[i] >> b[i] >> c[i] >> d[i];\n  }\n  __int128_t ok = A.back() + 1, ng = A.front() - 1;\n  auto check1 = [&](__int128_t v) {\n    for(int i = 0; i < Q; i++) {\n      if(a[i] == 1) {\n        if(v >= b[i]) v = d[i] * (v + c[i]);\n      } else {\n        if(v <= b[i]) v = (v - c[i]) / d[i];\n      }\n    }\n    return L <= v;\n  };\n  while(ok - ng > 1) {\n    auto md = (ok + ng) / 2;\n    if(check1(md)) ok = md;\n    else ng = md;\n  }\n\n  auto LLL = ok;\n\n  ok = A.back() + 1, ng = A.front() - 1;\n  swap(ok, ng);\n  auto check2 = [&](__int128_t v) {\n    for(int i = 0; i < Q; i++) {\n      if(a[i] == 1) {\n        if(v >= b[i]) v = d[i] * (v + c[i]);\n      } else {\n        if(v <= b[i]) v = (v - c[i]) / d[i];\n      }\n    }\n    return v <= R;\n  };\n  while(ng - ok > 1) {\n    auto md = (ok + ng) / 2;\n    if(check2(md)) ok = md;\n    else ng = md;\n  }\n\n  auto RRR = ok;\n  cout << upper_bound(begin(A), end(A), RRR) - lower_bound(begin(A), end(A), LLL) << endl;\n\n}\n\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n\n#define ll long long\n#define rep(i,n) for(int i=0;i<(n);i++)\n\nusing namespace std;\n\nint main()\n{\n\tll n, q, L, R;\n\tcin>>n>>q>>L>>R;\n\tvector<ll> a(n), Q(q), x(q), s(q), t(q);\n\trep(i, n) cin>>a[i];\n\tsort(a.begin(), a.end());\n\tll solveL, solveR;\n\trep(i, q){\n\t\tcin>>Q[i]>>x[i]>>s[i]>>t[i];\n\t}\n\n\tll left=-1;\n\tll right=n;\n\t//L condition\n\twhile(right-left>1){\n\t\tll mid = (left+right)/2;\n\t\tll ma = a[mid];\n\t\trep(i, q){\n\t\t\tif (Q[i]==1 && ma>=x[i]){\n\t\t\t\tma = (ma+s[i])*t[i];\n\t\t\t}else if(Q[i]==2 && ma<=x[i]){\n\t\t\t\tma = (ma-s[i])/t[i];\n\t\t\t}\n\t\t}\n\t\tif (ma>=L){\n\t\t\tright = mid;\n\t\t}else{\n\t\t\tleft = mid;\n\t\t}\n\t}\n\tsolveL = right;\n\tleft=-1;\n\tright=n;\n\t//L condition\n\twhile(right-left>1){\n\t\tll mid = (left+right)/2;\n\t\tll ma = a[mid];\n\t\trep(i, q){\n\t\t\tif (Q[i]==1 && ma>=x[i]){\n\t\t\t\tma = (ma+s[i])*t[i];\n\t\t\t}else if(Q[i]==2 && ma<=x[i]){\n\t\t\t\tma = (ma-s[i])/t[i];\n\t\t\t}\n\t\t}\n\t\tif (ma>R){\n\t\t\tright = mid;\n\t\t}else{\n\t\t\tleft = mid;\n\t\t}\n\t}\n\tsolveR = left;\n\tcout << solveR-solveL+1 << endl;\n\treturn 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n#define int long long\nusing namespace std;\nconst int maxn=1000005;\nint a[maxn],b[maxn],opt[maxn],limit[maxn],x[maxn],y[maxn],L,R,n,m;\nint check(int mid)\n{\n//\tcout<<mid<<\" \"<<a[mid]<<\" \";\n\tint now=a[mid];\n\tfor(int i=1;i<=m;i++)\n\t{\n\t\tif(opt[i]==1)\n\t\t{\n\t\t\tif(now>=limit[i])now=(now+x[i])*y[i];\n\t\t}\n\t\telse if(now<=limit[i])now=(now-x[i])/y[i];\t\n\t}\n\t\n//\tcout<<now<<endl;\n\treturn now;\n}\nsigned main()\n{\n\tcin>>n>>m>>L>>R;\n\tfor(int i=1;i<=n;i++)cin>>a[i];\n\tfor(int i=1;i<=m;i++)cin>>opt[i]>>limit[i]>>x[i]>>y[i];\n\tsort(a+1,a+1+n);\n\tint l=1,r=n,ans1=0;\n\twhile(l<=r)\n\t{\n\t\tint mid=(l+r)/2;\n\t\tif(check(mid)<=R)ans1=mid,l=mid+1;\n\t\telse r=mid-1; \n\t} \n//\tcout<<ans1<<endl;\n\tl=1,r=n;int ans2=n+1;\n\twhile(l<=r)\n\t{\n\t\tint mid=(l+r)/2;\n\t\tif(check(mid)>=L)ans2=mid,r=mid-1;\n\t\telse l=mid+1; \n\t} //cout<<ans2<<endl;\n\tcout<<ans1-ans2+1<<endl;\n\t\n}\n/*\n3 3 3 10\n1 -2 3\n1 2 2 3\n2 20 1 3\n2 1 20 5\n首先那些不构成约束的边直接就是2^k/2，随便取，然后有一半的概率是不合法的\n对于有约束的边就看下约束\n每次枚举一个点，然后开始检查所有边 \n \n */\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\n#define rep(i,n) for(int i=0;i<n;i++)\ntypedef long long ll;\n\nsigned main(){\n    ll n,q,l,r;\n    cin>>n>>q>>l>>r;\n    ll a[n];\n    for(int i=0;i<n;i++){\n        cin>>a[i];\n    }\n    ll p[q],x[q],s[q],t[q];\n    for(int i=0;i<q;i++){\n        cin>>p[i]>>x[i]>>s[i]>>t[i];\n    }\n    sort(a,a+n);\n    ll low = 0,up = n;\n    while(up-low>0){\n        ll mid = (low+up)/2;\n        ll now = a[mid];\n        for(int i=0;i<q;i++){\n            if(p[i]==1){\n                if(x[i]>now) continue;\n                now = t[i] * (now+s[i]);\n            }\n            else {\n                if(x[i]<now) continue;\n                now = (now - s[i])/t[i];\n            }\n        }\n        if(now<l){\n            low = mid+1;\n        }\n        else up = mid;\n    }\n    ll L=low;\n    low = 0, up = n;\n    while(up-low>0){\n        ll mid = (low+up)/2;\n        ll now = a[mid];\n        for(int i=0;i<q;i++){\n            if(p[i]==1){\n                if(x[i]>now) continue;\n                now = t[i] * (now+s[i]);\n            }\n            else {\n                if(x[i]<now) continue;\n                now = (now - s[i])/t[i];\n            }\n        }\n        if(now<=r){\n            low = mid+1;\n        }\n        else up = mid;\n    }\n    ll R = low;\n    //cout << L << \" \" << R << endl;\n    ll ans = max(0LL,R-L);\n    cout << ans << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define REP(i, N) for (ll i = 0; i < (N); ++i)\n\nll N, Q, L, R;\nvector<ll> A;\nvector<tuple<ll, ll, ll, ll>> query;\n\nconst ll INF = (ll)1e9 + 7;\n\nsigned main() {\n\n    cin >> N >> Q >> L >> R;\n\n    A.resize(N + 1);\n    A[0] = -INF;\n    REP(i, N) cin >> A[i + 1];\n\n    sort(A.begin(), A.end());\n\n    // REP(i, N) cerr << A[i] << endl;\n\n    REP(i, Q) {\n        ll q, x, s, t;\n        cin >> q >> x >> s >> t;\n        query.emplace_back(make_tuple(q, x, s, t));\n    }\n\n    function<bool(ll, ll)> check = [&](ll m, ll MAX) {\n        if (m == -INF) return true;\n        REP(i, Q) {\n            ll q, x, s, t;\n            tie(q, x, s, t) = query[i];\n            if (q == 1) {\n                if (m >= x) {\n                    m = t * (m + s);\n                }\n            } else {\n                if (m <= x) {\n                    m = (m - s) / t;\n                }\n            }\n        }\n        return (m <= MAX);\n    };\n\n    ll l = 0, r = 0;\n\n    {\n        ll ok = 0, ng = N + 1;\n        while (abs(ok - ng) > 1) {\n            ll mid = (ok + ng) / 2;\n            if (check(A[mid], R)) {\n                ok = mid;\n            } else {\n                ng = mid;\n            }\n        }\n        r = ok;\n    }\n\n    {\n        ll ok = 0, ng = N + 1;\n        while (abs(ok - ng) > 1) {\n            ll mid = (ok + ng) / 2;\n            if (check(A[mid], L - 1)) {\n                ok = mid;\n            } else {\n                ng = mid;\n            }\n        }\n        l = ok;\n    }\n\n    cout << max<ll>(0, r - l) << endl;\n\n    // cerr << l << ' ' << r << endl;\n\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n#define ll long long\n#define rep(i, n) for(int i=0;i<(n);++i)\n#define per(i, n) for(int i=(n)-1;i>=0;--i)\n#define repa(i, n) for(int i=1;i<(n);++i)\n#define foreach(i, n) for(auto &i:(n))\n#define pii pair<int, int>\n#define pll pair<long long, long long>\n#define all(x) (x).begin(), (x).end()\n#define bit(x) (1ll << (x))\nconst ll MOD = (ll)1e9+7;\nconst ll INF = (ll)1e9+7;\nconst ll INFLL = (ll)1e18;\nusing namespace std;\ntemplate<class t, class u> bool chmax(t &a, u b){if(a<b){a=b;return true;}return false;}\ntemplate<class t, class u> bool chmin(t &a, u b){if(a>b){a=b;return true;}return false;}\n\nll modpow(ll x, ll b){\n\tll res = 1;\n\twhile(b){\n\t\tif(b&1)res = res * x % MOD;\n\t\tx = x * x % MOD;\n\t\tb>>=1;\n\t}\n\treturn res;\n}\n\nll modinv(ll x){\n\treturn modpow(x, MOD-2);\n}\n\nint main(){\n\tll n, q, l, r;\n\tcin >> n >> q >> l >> r;\n\tvector<ll> line(n);\n\tforeach(i, line)cin>>i;\n\n\tvector<vector<ll>> querys(q, vector<ll>(4));\n\tforeach(i, querys){\n\t\tforeach(j, i)cin >> j;\n\t}\n\n\tauto func = [&](ll num){\n\t\tforeach(i, querys){\n\t\t\tll q = i[0], x = i[1], s = i[2], t = i[3];\n\t\t\tif(q==1){\n\t\t\t\tif(num>=x){\n\t\t\t\t\tnum = (num + s) * t;\n\t\t\t\t}\n\t\t\t}else{\n\t\t\t\tif(num<=x){\n\t\t\t\t\tnum = (num - s) / t;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tint res = (l <= num)?1:0;\n\t\tres |= (num <= r)?2:0;\n\t\treturn res;\n\t};\n\n\tsort(all(line));\n\n\tll lo = 0, lh = n;\n\twhile(lo < lh){\n\t\tll mid = (lo+lh) >> 1;\n\t\tif(func(line[mid])&1){\n\t\t\tlh = mid;\n\t\t}else{\n\t\t\tlo = mid + 1;\n\t\t}\n\t}\n\n\tll ro = 0, rh = n;\n\twhile(ro < rh){\n\t\tll mid = (ro+rh) >> 1;\n\t\tif(func(line[mid])&2){\n\t\t\tro = mid + 1;\n\t\t}else{\n\t\t\trh = mid;\n\t\t}\n\t}\n\tcout << ro - lo << endl;\n\n\n\treturn 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\n\n#define repl(i,a,b) for(int i=(int)(a);i<(int)(b);i++)\n#define rep(i,n) repl(i,0,n)\nusing ll=long long;\n\nll calc(const vector<vector<ll>>& querys, ll num){\n  for(const auto& query: querys){\n    ll q=query[0], x=query[1], s=query[2], t=query[3];\n    if(q==1){\n      if(x<=num)num=(num+s)*t;\n    }else{\n      if(num<=x)num=(num-s)/t;// marumekomi?\n    }\n  }\n  return num;\n}\n\nint main(){\n  ll N,Q,L,R;\n  cin>>N>>Q>>L>>R;\n  vector<ll> A(N);\n  vector<vector<ll>> querys(Q,vector<ll>(4));\n\n  rep(i,N)cin>>A[i];\n  sort(A.begin(),A.end());\n  rep(i,Q)rep(j,4)cin>>querys[i][j];\n\n  ll res1,res2;\n  ll l=-1,r=N-1;\n  while(r-l>1){\n    ll mid=(l+r)/2;\n    (L<=calc(querys, A[mid]) ? r:l)=mid;\n  }\n  res1=r;\n\n  l=0,r=N;\n  while(r-l>1){\n    ll mid=(l+r)/2;\n    (calc(querys, A[mid])<=R ? l:r)=mid;\n  }\n  res2=l;\n  //cerr<<res1<<\"--\"<<res2<<endl;\n  cout<<res2-res1+1<<endl;\n  return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\n#define F first\n#define S second\n#define pii pair<int, int>\n#define eb emplace_back\n#define all(v) v.begin(), v.end()\n#define rep(i, n) for (int i = 0; i < (n); ++i)\n#define rep3(i, l, n) for (int i = l; i < (n); ++i)\n#define sz(v) (int)v.size()\n#define inf (int)(1e9+7)\n#define abs(x) (x >= 0 ? x : -(x))\n#define ceil(a, b) a / b + !!(a % b)\ntemplate<typename T1, typename T2> inline void chmin(T1 &a, T2 b) { if (a > b) a = b; }\ntemplate<typename T1, typename T2> inline void chmax(T1 &a, T2 b) { if (a < b) a = b; }\nll pow(ll a, int b) { return b ? pow(a * a, b / 2) * (b % 2 ? a : 1) : 1; }\ntemplate<typename T> T gcd(T a, T b) { if (b == 0) return a; return gcd(b, a % b); }\n\n\n\nint n, Q;\nll l, r;\nvector<pair<pair<int, ll>, pii> > v;\nvector<int> a;\n\nll calc(ll A) {\n    for (auto &p: v) {\n        int q, s, t;\n        ll x;\n        tie(q, x) = p.first;\n        tie(s, t) = p.second;\n        if (q == 1) {\n            if (A < x) continue;\n            A = 1LL * t * (A + s);\n        } else {\n            if (A > x) continue;\n            A = (A - s) / t;\n        }\n    }\n    return A;\n}\n\nvoid small() {\n    ll A = a[0];\n    \n    A = calc(A);\n    \n    if (l <= A && A <= r) cout << 1 << '\\n';\n    else cout << 0 << '\\n';\n}\n\nint main() {\n    cin >> n >> Q >> l >> r;\n    \n    a.resize(n);\n    rep(i, n) cin >> a[i];\n    sort(all(a));\n    \n    \n    rep(i, Q) {\n        int q, s, t; ll x;\n        cin >> q >> x >> s >> t;\n        v.eb(make_pair(make_pair(q, x), pii(s, t)));\n    }\n    \n    if (n == 1) {\n        small();\n        return 0;\n    }\n    \n    // l\n    int L = -1, R = n - 1;\n    while (true) {\n        int mid = (L + R) / 2;\n        ll A = a[mid];\n        A = calc(A);\n        \n        if (A < l) {\n            L = mid;\n        } else {\n            R = mid;\n        }\n        if (L + 1 == R) break;\n    }\n    int tmpR = R;\n    \n    // r\n    L = 0; R = n;\n    while (true) {\n        int mid = (L + R) / 2;\n        ll A = a[mid];\n        A = calc(A);\n        \n        if (A > r) {\n            R = mid;\n        } else {\n            L = mid;\n        }\n        if (L + 1 == R) break;\n    }\n    // cout << L << \" \" << tmpR << '\\n';\n    \n    if (L == tmpR) {\n        ll A = a[L];\n        A = calc(A);\n        \n        if (l <= A && A <= r) cout << 1 << endl;\n        else cout << 0 << endl;\n        return 0;\n    }\n    \n    cout << L - tmpR + 1 << endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\n#define rep(i,a,n) for (int i=a;i<n;i++)\n#define per(i,a,n) for (int i=n-1;i>=a;i--)\n#define pb push_back\n#define mp make_pair\n#define all(x) (x).begin(),(x).end()\n#define SZ(x) ((int)(x).size())\n#define fi first\n#define se second\ntypedef vector<int> VI;\ntypedef long long ll;\ntypedef pair<int,int> PII;\nconst ll mod=1000000007;\nll powmod(ll a,ll b) {ll res=1;a%=mod;for(;b;b>>=1){if(b&1)res=res*a%mod;a=a*a%mod;}return res;}\n// head\n\nconst int N=201000;\nint n,q,a[N];\nll L,R,f[N][4];\nint main() {\n\tscanf(\"%d%d%lld%lld\",&n,&q,&L,&R);\n\trep(i,0,n) scanf(\"%d\",a+i);\n\trep(i,0,q) scanf(\"%lld%lld%lld%lld\",f[i],f[i]+1,f[i]+2,f[i]+3);\n\tsort(a,a+n);\n\tint l=-1,r=n;\n\twhile (l+1<r) {\n\t\tint md=(l+r)>>1;\n\t\t__int128_t p=a[md];\n\t\trep(i,0,q) {\n\t\t\tif (f[i][0]==1) {\n\t\t\t\tif (p>=f[i][1]) p=(p+f[i][2])*f[i][3];\n\t\t\t} else {\n\t\t\t\tif (p<=f[i][1]) p=(p-f[i][2])/f[i][3];\n\t\t\t}\n\t\t}\n\t\t//printf(\"%d %lld\\n\",md,(ll)p);\n\t\tif (p>=L) r=md; else l=md;\n\t}\n\tint x=r;\n\tl=-1,r=n;\n\twhile (l+1<r) {\n\t\tint md=(l+r)>>1;\n\t\t__int128_t p=a[md];\n\t\trep(i,0,q) {\n\t\t\tif (f[i][0]==1) {\n\t\t\t\tif (p>=f[i][1]) p=(p+f[i][2])*f[i][3];\n\t\t\t} else {\n\t\t\t\tif (p<=f[i][1]) p=(p-f[i][2])/f[i][3];\n\t\t\t}\n\t\t}\n\t\t//printf(\"%d %lld\\n\",md,(ll)p);\n\t\tif (p<=R) l=md; else r=md;\n\t}\n\t//printf(\"%d %d\\n\",l,x);\n\tprintf(\"%d\\n\",l-x+1);\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\n\nusing ll=long long;\n\nint main(){\n    ll N,Q,L,R;\n    cin>>N>>Q>>L>>R;\n\n    vector<ll> A(N);\n    for(int i=0;i<N;i++) cin>>A[i];\n    sort(A.begin(),A.end());\n    vector<int> q(Q);\n    vector<ll> x(Q),s(Q),t(Q);\n    for(int i=0;i<Q;i++) cin>>q[i]>>x[i]>>s[i]>>t[i];\n\n    int lb=-1,ub=N;\n    while(ub-lb>1){\n        int mid=(lb+ub)/2;\n        ll v = A[mid];\n\n        for(int i=0;i<Q;i++){\n            if(q[i]==1){\n                if(v>=x[i]) v=(v+s[i])*t[i];\n            }\n            else{\n                if(v<=x[i]) v=(v-s[i])/t[i];\n            }\n        }\n\n        if(v<L) lb=mid;\n        else ub=mid;\n    } \n    int lid=ub;\n\n    lb=-1,ub=N;\n    while(ub-lb>1){\n        int mid=(lb+ub)/2;\n        ll v = A[mid];\n\n        for(int i=0;i<Q;i++){\n            if(q[i]==1){\n                if(v>=x[i]) v=(v+s[i])*t[i];\n            }\n            else{\n                if(v<=x[i]) v=(v-s[i])/t[i];\n            }\n        }\n\n        if(v>R) ub=mid;\n        else lb=mid;\n    }\n    \n    int rid=ub;\n    cout<<max(0,rid-lid)<<endl;\n    \n    return 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\n\ntypedef __int128 ll;\ntypedef vector<ll> vl;\n\nll n,q,l,r;\nvl a;\nvl query,x,s,t;\nll ans_l,ans_r,ans;\n\nbool judge(ll a,ll thresh){\n\tfor(ll i = 0;i < q;i++){\n\t\tif(query[i] == 1){\n\t\t\tif(a >= x[i]){\n\t\t\t\ta = t[i]*(a+s[i]);\n\t\t\t}\n\t\t}else if(query[i] == 2){\n\t\t\tif(a <= x[i]){\n\t\t\t\ta = (a-s[i])/t[i];\n\t\t\t}\n\t\t}\n\t}\n\tif(a >= thresh) return true;\n\telse return false;\n}\n\nint main(){\n\t// cerr << ((ll)1 << 63)-1 << endl;\n\t// cerr << (((ll)1 << 63)-1)*-1 << endl;\n\tlong long N,Q,L,R;\n\tcin >> N >> Q >> L >> R;\n\tn = N;\n\tq = Q;\n\tl = L;\n\tr = R;\n\ta = vl(n);\n\tfor(ll i = 0;i < n;i++){\n\t\tlong long tmp;\n\t\tcin >> tmp;\n\t\ta[i] = tmp;\n\t}\n\t// for(ll i = 0;i < n;i++) cin >> a[i];\n\tquery = x = s = t = vl(q);\n\tfor(ll i = 0;i < q;i++){\n\t\tlong long hoge,fuga,zaki,o;\n\t\tcin >> hoge >> fuga >> zaki >> o;\n\t\tquery[i] = hoge;\n\t\tx[i] = fuga;\n\t\ts[i] = zaki;\n\t\tt[i] = o;\n\t}\n\t// for(ll i = 0;i < q;i++) cin >> query[i] >> x[i] >> s[i] >> t[i];\n\tll top = ((ll)1 << 63)-1;\n\tll bottom = top*-1;\n\twhile(top-bottom > 1){\n\t\tll middle = (top+bottom)/2;\n\t\tif(judge(middle,l)) top = middle;\n\t\telse bottom = middle;\n\t}\n\tans_l = top;\n\ttop = ((ll)1 << 63)-1;\n\tbottom = top*-1;\n\twhile(top-bottom > 1){\n\t\tll middle = (top+bottom)/2;\n\t\tif(judge(middle,r+1)) top = middle;\n\t\telse bottom = middle;\n\t}\n\tans_r = top;\n\t// cerr << (long long)ans_l << \" \" << (long long)ans_r << endl;\n\tsort(a.begin(),a.end());\n\tcout << lower_bound(a.begin(),a.end(),ans_r)-lower_bound(a.begin(),a.end(),ans_l) << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <iostream>\n#include <vector>\n#include <algorithm>\n#include <tuple>\n#include <array>\n\n#define ll long long\n\nusing namespace std;\n\nvector<ll> A;\nvector<array<long long, 4>> Q;\n\nll calc(ll v) {\n\tfor (const auto& q : Q) {\n\t\tll p, x, s, t;\n\t\tp = q[0];\n\t\tx = q[1];\n\t\ts = q[2];\n\t\tt = q[3];\n\n\t\tif (p == 1 and v >= x) {\n\t\t\tv = t * (v + s);\n\t\t}\n\t\telse if (p == 2 and v <= x) {\n\t\t\tv = (v - s) / t;\n\t\t}\n\n\t}\n\n\treturn v;\n}\n\nsigned main() {\n\tint n, q;\n\tll L, R;\n\tcin >> n >> q >> L >> R;\n\n\tA.resize(n);\n\tfor (auto& a : A) cin >> a;\n\tsort(A.begin(), A.end());\n\n\tfor (int i = 0; i < q; i++) {\n\t\tll p, x, s, t;\n\t\tcin >> p >> x >> s >> t;\n\t\tQ.push_back({ p, x, s, t });\n\t}\n\n\tint ng = -1, ok = n;\n\n\twhile (ok - ng > 1) {\n\t\tint mid = (ok + ng) / 2;\n\t\tif (calc(A[mid]) >= L) {\n\t\t\tok = mid;\n\t\t}\n\t\telse {\n\t\t\tng = mid;\n\t\t}\n\t}\n\n\tint l = ok;\n\n\tng = n, ok = -1;\n\n\twhile (abs(ok - ng) > 1) {\n\t\tint mid = (ok + ng) / 2;\n\t\tif (calc(A[mid]) <= R) {\n\t\t\tok = mid;\n\t\t}\n\t\telse {\n\t\t\tng = mid;\n\t\t}\n\t}\n\n\tint r = ok;\n\t\n\tcout << max(0, r - l + 1) << endl;\n\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\ntypedef long long int ll;\ntypedef unsigned long long int ull;\n#define BIG_NUM 2000000000\n#define HUGE_NUM 99999999999999999\n#define MOD 1000000007\n#define EPS 0.000000001\nusing namespace std;\n\n\n#define SIZE 200005\n\nstruct Query{\n\n\tll q,x,s,t;\n};\n\nll N,Q,minimum,maximum;\nll A[SIZE];\nQuery query[SIZE];\n\n\nint main(){\n\n\tscanf(\"%lld %lld %lld %lld\",&N,&Q,&minimum,&maximum);\n\n\tfor(int i = 0; i < N; i++){\n\n\t\tscanf(\"%lld\",&A[i]);\n\t}\n\n\tsort(A,A+N);\n\n\tfor(int i = 0; i < Q; i++){\n\n\t\tscanf(\"%lld %lld %lld %lld\",&query[i].q,&query[i].x,&query[i].s,&query[i].t);\n\t}\n\n\tint left = N;\n\tint L = 0,R = N-1,mid = (L+R)/2;\n\n\twhile(L <=R){\n\n\t\tll tmp = A[mid];\n\n\t\tfor(int i = 0; i < Q; i++){\n\n\t\t\tif(query[i].q == 1){ //AddMul\n\n\t\t\t\tif(tmp < query[i].x)continue;\n\n\t\t\t\ttmp += query[i].s;\n\t\t\t\ttmp *= query[i].t;\n\n\t\t\t}else{ //SubDiv\n\n\t\t\t\tif(tmp > query[i].x)continue;\n\n\t\t\t\ttmp -= query[i].s;\n\t\t\t\ttmp /= query[i].t;\n\t\t\t}\n\t\t}\n\n\t\tif(tmp >= minimum){\n\n\t\t\tleft = mid;\n\t\t\tR = mid-1;\n\n\t\t}else{\n\n\t\t\tL = mid+1;\n\t\t}\n\t\tmid = (L+R)/2;\n\t}\n\n\tint right = -1;\n\tL = 0,R = N-1,mid = (L+R)/2;\n\n\twhile(L <= R){\n\n\t\tll tmp = A[mid];\n\n\t\tfor(int i = 0; i < Q; i++){\n\n\t\t\tif(query[i].q == 1){ //AddMul\n\n\t\t\t\tif(tmp < query[i].x)continue;\n\n\t\t\t\ttmp += query[i].s;\n\t\t\t\ttmp *= query[i].t;\n\n\t\t\t}else{ //SubDiv\n\n\t\t\t\tif(tmp > query[i].x)continue;\n\n\t\t\t\ttmp -= query[i].s;\n\t\t\t\ttmp /= query[i].t;\n\t\t\t}\n\t\t}\n\n\t\tif(tmp <= maximum){\n\n\t\t\tright = mid;\n\t\t\tL = mid+1;\n\n\t\t}else{\n\n\t\t\tR = mid-1;\n\t\t}\n\t\tmid = (L+R)/2;\n\t}\n\n\tprintf(\"%d\\n\",max(0,right-left+1));\n\n\treturn 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n\nusing namespace std;\n\n#define REP(i,n) for(ll (i) = (0);(i) < (n);++i)\n#define ALL(v) v.begin(),v.end()\n#define FI first\n#define SE second\n\ntypedef long long ll;\ntypedef pair<ll, ll> P;\nll n, q, l, r;\n\nll seica(ll num, vector<pair<P, P>> &que) {\n    REP(i, q){\n        ll x = que[i].FI.SE;\n        ll s = que[i].SE.FI;\n        ll t = que[i].SE.SE;\n        if(que[i].FI.FI == 1){\n            if(num >= x){\n                num = t * (num + s);\n            }\n        }\n        else {\n            if(num <= x){\n                num = (num - s) / t;\n            }\n        }\n    }\n    return num;\n}\n\nbool checkMIN(ll num, vector<pair<P, P>> &que) {\n    num = seica(num, que);\n    return num < l;\n}\n\nbool checkMAX(ll num, vector<pair<P, P>> &que) {\n    num = seica(num, que);\n    return num <= r;\n}\n\nint main() {\n    cin >> n >> q >> l >> r;\n    vector<ll> v(n);REP(i, n)cin >> v[i];\n    vector<pair<P, P>> que(q);\n    REP(i, q){\n        cin >> que[i].FI.FI >> que[i].FI.SE >> que[i].SE.FI >> que[i].SE.SE;\n    }\n\n    sort(ALL(v));\n    ll L = -1, R = n;\n    while(R - L > 1){\n        ll mid = (L + R) / 2;\n        //cout << \"mim \" << L << \" \" << R << \" \" << mid << endl;\n        if(checkMIN(v[mid], que))L = mid;\n        else R = mid;\n    }\n    ll ans_l = L;\n    L = -1;R = n;\n    while(R - L > 1){\n        ll mid = (L + R) / 2;\n        //cout << \"mim \" << L << \" \" << R << \" \" << mid << endl;\n        if(checkMAX(v[mid], que))L = mid;\n        else R = mid;\n    }\n    ll ans_r = L;\n    //cout << \"ans \" << ans_l << \" \" << ans_r << endl;\n\n    cout << max(0LL, ans_r - ans_l) << endl;\n    return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n#define ll long long\n#define maxn 200005 /*rem*/\n#define mod 998244353\n#define db double\n#define vi vector<int>\n#define pb push_back\n#define mp make_pair\n#define pi pair<int, int>\n#define fi first\n#define se second\nusing namespace std;\nll ksm(ll a, ll b) {\n   if (!b) return 1;\n   ll ns = ksm(a, b >> 1);\n   ns = ns * ns % mod;\n   if (b & 1) ns = ns * a % mod;\n   return ns;\n}\nll L, R;\nint n, q;\nll a[maxn];\nll tp[maxn], s[maxn], x[maxn], t[maxn];\nll ca(ll b) {\n\tfor (int j = 0; j < q; j++) {\n\t\tif (tp[j] == 1 && b >= x[j])\n\t\t\tb = (b + s[j]) * t[j];\n\t\tif (tp[j] == 2 && b <= x[j])\n\t\t\tb = (b - s[j]) / t[j];\n\t}\n\treturn b;\n}\nll cal(ll k) {\n\t// 多少个 <= k \n\tint l = 0, r = n - 1;\n\tif (ca(a[r]) <= k) return n; \n\twhile (l < r) {\n\t\tint mid = (l + r) >> 1;\n\t\tif (ca(a[mid]) > k) r = mid;\n\t\telse l = mid + 1;\n\t}\n\treturn l;\n}\nint main() {\n\tcin >> n >> q >> L >> R;\n\tfor (int i = 0; i < n; i++)\n\t\tscanf(\"%lld\", &a[i]);\n\tsort(a, a + n);\n\tfor (int i = 0; i < q; i++) {\n\t\tscanf(\"%lld%lld%lld%lld\", &tp[i], &x[i], &s[i], &t[i]);\n\t}\n\tll ans = cal(R) - cal(L - 1);\n\tcout << ans << endl;\n\treturn 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n#define rep(i,n)for(int i=0;i<(n);i++)\nusing namespace std;\ntypedef long long ll;\ntypedef pair<int,int>P;\n\nint n,q;\nll L,R;\nll a[300000];\nll ty[300000],x[300000],s[300000],t[300000];\n\nll calc(ll C){\n\trep(i,q){\n\t\tif(ty[i]==1){\n\t\t\tif(C>=x[i])C=(C+s[i])*t[i];\n\t\t}\n\t\telse{\n\t\t\tif(C<=x[i])C=(C-s[i])/t[i];\n\t\t}\n\t}\n\treturn C;\n}\n\nint calc2(ll t){//<=t\n\tint ok=-1,ng=n;\n\twhile(ng-ok>1){\n\t\tint md=(ok+ng)/2;\n\t\tif(calc(a[md])<=t)ok=md;\n\t\telse ng=md;\n\t}\n\treturn ok+1;\n}\nint main(){\n\tcin>>n>>q>>L>>R;\n\trep(i,n)scanf(\"%lld\",&a[i]);\n\trep(i,q){\n\t\tscanf(\"%lld%lld%lld%lld\",&ty[i],&x[i],&s[i],&t[i]);\n\t}\n\tsort(a,a+n);\n\tcout<<calc2(R)-calc2(L-1)<<endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "    #include <bits/stdc++.h>\nusing namespace std;\nusing Int = long long;\n\nstruct Query {\n\tInt q, x, s, t;\n\tQuery(){}\n};\n\nint main() {\n\tInt n, q, l, r;\n\tcin >> n >> q >> l >> r;\n\tvector<Int> a(n);\n\tfor(auto& x : a) cin >> x;\n\tsort(a.begin(), a.end());\n\n\tvector<Query> query(q);\n\tfor(auto& x : query) {\n\t\tcin >> x.q >> x.x >> x.s >> x.t;\n\t}\n\n\tauto sim = [&](Int a) {\n\t\tfor(auto& x : query) {\n\t\t\tif (x.q == 1) {\n\t\t\t\tif (a < x.x) continue;\n\t\t\t\ta += x.s;\n\t\t\t\ta *= x.t;\n\t\t\t} else {\n\t\t\t\tif (a > x.x) continue;\n\t\t\t\ta -= x.s;\n\t\t\t\tbool neg = (a < 0);\n\t\t\t\ta = abs(a);\n\t\t\t\ta /= x.t;\n\t\t\t\tif (neg) a = -a;\n\t\t\t}\n\t\t}\n\t\treturn a;\n\t};\n\n\tInt lx, rx;\n\t// finally no less than l (max),\n\t//     and no more than r (min)\n\t{\n\t\tInt ok = n, ng = -1;\n\t\twhile (ok - ng > 1) {\n\t\t\tInt mid = (ok + ng) / 2;\n\t\t\t(sim(a[mid]) >= l ? ok : ng) = mid;\n\t\t}\n\t\tlx = ok;\n\t}\n\tif (lx == n) {\n\t\tcout << 0 << endl;\n\t\treturn 0;\n\t}\n\n\t{\n\t\tInt ok = -1, ng = n;\n\t\twhile (ng - ok > 1) {\n\t\t\tInt mid = (ok + ng) / 2;\n\t\t\t(sim(a[mid]) <= r ? ok : ng) = mid;\n\t\t}\n\t\trx = ok;\n\t}\n\tif (rx == -1) {\n\t\tcout << 0 << endl;\n\t\treturn 0;\n\t}\n\n\tcout << rx - lx + 1 << endl;\n\treturn 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<iostream>\n#include<algorithm>\nusing namespace std;\nint N,Q;\nlong L,R;\nlong A[2<<17];\nint q[2<<17];\nlong x[2<<17],s[2<<17],t[2<<17];\nlong calc(int id)\n{\n\tlong now=A[id];\n\tfor(int i=0;i<Q;i++)\n\t{\n\t\tif(q[i]==1)\n\t\t{\n\t\t\tif(now>=x[i])\n\t\t\t{\n\t\t\t\tnow=t[i]*(now+s[i]);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif(now<=x[i])\n\t\t\t{\n\t\t\t\tnow=(now-s[i])/t[i];\n\t\t\t}\n\t\t}\n\t}\n\treturn now;\n}\nmain()\n{\n\tcin>>N>>Q>>L>>R;\n\tfor(int i=0;i<N;i++)cin>>A[i];\n\tsort(A,A+N);\n\tfor(int i=0;i<Q;i++)\n\t{\n\t\tcin>>q[i]>>x[i]>>s[i]>>t[i];\n\t}\n\tint l=-1,r=N;\n\twhile(r-l>1)\n\t{\n\t\tint M=l+r>>1;\n\t\tif(calc(M)<L)l=M;\n\t\telse r=M;\n\t}\n\tint left=r;\n\tl=-1,r=N;\n\twhile(r-l>1)\n\t{\n\t\tint M=l+r>>1;\n\t\tif(calc(M)>R)r=M;\n\t\telse l=M;\n\t}\n\tint right=l;\n\tcout<<right-left+1<<endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\n\nusing i64 = int64_t;\n\nstruct Query{\n    i64 q, x, s, t;\n};\n\nvoid update(int idx, vector<i64> &v, deque<bool> &updated, const vector<Query> &query){\n    if(updated[idx])return;\n    for(auto q: query){\n        if(q.q == 1){\n            if(v[idx] < q.x)continue;\n            v[idx] += q.s;\n            v[idx] *= q.t;\n        }else{\n            if(v[idx] > q.x)continue;\n            v[idx] -= q.s;\n            v[idx] /= q.t;\n        }\n    }\n    updated[idx] = true;\n}\n\nint main(){\n    i64 n, q, l, r;\n    cin >> n >> q >> l >> r;\n    vector<i64> v;\n    for(int i=0;i<n;++i){\n        i64 a;\n        cin >> a;\n        v.push_back(a);\n    }\n    sort(v.begin(), v.end());\n    deque<bool> updated(n, false);\n\n    vector<Query> query;\n    for(int i=0;i<q;++i){\n        i64 q, x, s, t;\n        cin >> q >> x >> s >> t;\n        query.push_back({q, x, s, t});\n    }\n\n    int ri = n, li = -1;\n    while(ri-li > 1){\n        int mi = (ri + li) / 2;\n        update(mi, v, updated, query);\n        if(v[mi] > r)ri = mi;\n        else li = mi;\n    }\n    int R = ri;\n    ri = n; li = -1;\n    while(ri-li > 1){\n        int mi = (ri + li) / 2;\n        update(mi, v, updated, query);\n        if(v[mi] < l)li = mi;\n        else ri = mi;\n    }\n    int L = li + 1;\n\n    cout << R - L << endl;\n\n    return 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\nusing i64 = long long;\n#define rep(i,s,e) for(i64 (i) = (s);(i) < (e);(i)++)\n#define all(x) x.begin(),x.end()\n#define let auto const\n\ntemplate<typename... Types>\nstruct dynarr: std::vector<Types...> {\n  using std::vector<Types...>::vector;\n  using size_type = typename std::vector<Types...>::size_type;\n  auto&& operator[](size_type i) { return this->at(i); }\n  auto&& operator[](size_type i) const { return this->at(i); }\n};\n\nstruct query {\n  i64 type;\n  i64 x;\n  i64 s;\n  i64 t;\n};\n\n\nint main() {\n  i64 N, Q, L, R;\n  cin >> N >> Q >> L >> R;\n  vector<i64> A(N);\n  rep(i,0,N) {\n    cin >> A[i];\n  }\n  sort(all(A));\n  vector<query> qq;\n  rep(i,0,Q) {\n    i64 type, x, s, t;\n    cin >> type >> x >> s >> t;\n    qq.push_back({ type, x, s, t });\n  }\n\n  auto calc = [&](i64 i) {\n    i64 a = A[i];\n    for(auto q: qq) {\n      i64 x = q.x;\n      i64 s = q.s;\n      i64 t = q.t;\n      if(q.type == 1) {\n        if(x <= a) {\n          a = (a + s) * t;\n        }\n      }\n      else {\n        if(a <= x) {\n          a = (a - s) / t;\n        }\n      }\n    }\n    return a;\n  };\n\n  i64 Li;\n  i64 Ri;\n\n  {\n    i64 OK = -1;\n    i64 NG = N;\n\n    while(abs(NG - OK) > 1) {\n      i64 m = (OK + NG) / 2;\n      if(calc(m) < L) { OK = m; }\n      else { NG = m; }\n    }\n    Li = OK;\n  }\n  {\n    i64 OK = -1;\n    i64 NG = N;\n\n    while(abs(NG - OK) > 1) {\n      i64 m = (OK + NG) / 2;\n      if(calc(m) <= R) { OK = m; }\n      else { NG = m; }\n    }\n    Ri = OK;\n  }\n  cout << Ri - Li << endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\n#define r(i,n) for(int i=0;i<n;i++)\nusing namespace std;\n#define int long long\n\nint n,m,L,R,s[200009],t[200009];\nint a[200009],x[200009];\nint query[200009];\n\nbool ch1(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  return R<A;\n}\n\nbool ch2(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  return L<=A;\n}\n\nvoid ch3(int mid){\n  int A=a[mid];\n  r(i,m){\n    if(query[i]==1 && A>=x[i]) A=(A+s[i])*t[i];\n    if(query[i]==2 && A<=x[i]) A=(A-s[i])/t[i];\n  }\n  cout<<A<<endl;\n}\n\nsigned main(){\n  cin>>n>>m>>L>>R;\n  r(i,n)cin>>a[i];\n  r(i,m){\n    cin>>query[i]>>x[i]>>s[i]>>t[i];\n  }\n  //cout<<endl;\n  sort(a,a+n);\n\n  //r(i,n)ch3(i);\n\n  int l=-1,r=n;\n  while(r-l>1){\n    int mid=(r+l)/2;\n    if(ch1(mid))r=mid;\n    else l=mid;\n  }\n\n  int l2=-1,r2=n;\n  while(r2-l2>1){\n    int mid=(r2+l2)/2;\n    //cout<<r2<<l2<<mid<<endl;\n    if(ch2(mid))r2=mid;\n    else l2=mid;\n    //cout<<r2<<l2<<mid<<endl;\n  }\n  //cout<<r<<' '<<r2<<endl;\n\n  cout<<r-r2<<endl;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include <cstdio>\n#include <climits>\n#include <iostream>\n#include <vector>\n#include <algorithm>\nusing namespace std;\n\n__int128 div_floor(__int128 x, __int128 y) {\n  if (x >= 0) return x / y;\n  // x < 0\n  if (x % y == 0) return x / y;\n  return x/y - 1;\n}\n\n__int128 div_ceil(__int128 x, __int128 y) {\n  if (x >= 0) return (__int128(x)+y-1) / y;\n  if (x % y == 0) return x / y;\n  return x/y + 1;\n}\n\nint main(){\n  long long N, q, L0, R0;\n  cin >> N >> q >> L0 >> R0;\n  __int128 L = L0;\n  __int128 R = R0;\n  vector<long long> A(N);\n  for(int i = 0; i < N; ++i){\n    cin >> A[i];\n  }\n  //fprintf(stderr, \"%lld %lld %lld %lld (NqLR)\\n\", N, q, L, R);\n  vector<long long> Q(q), X(q), S(q), T(q);\n  for(int i = 0; i < q; ++i){\n    cin >> Q[i] >> X[i] >> S[i] >> T[i];\n  }\n  for(int i = q-1; i >= 0; --i){\n    //fprintf(stderr, \"%lld %lld %lld %lld (qxst)\\n\", Q[i], X[i], S[i], T[i]);\n    if(Q[i] == 1){\n      // R = R/T[i] - S[i];\n      // L = (L+T[i]-1)/T[i] - S[i];\n      __int128 R_ = div_floor(R, T[i]) - S[i];\n      __int128 L_ = div_ceil(L, T[i]) - S[i];\n      //fprintf(stderr,\"R_ = %lld, L_ = %lld, X[i] = %lld\\n\",R_,L_, X[i]);\n      if(R_ > X[i]) R = R_;\n      else if(R > X[i]) R = X[i];\n      if(L_ > X[i]) L = L_;\n      else if(L > X[i]) L = X[i];\n    }else{\n      __int128 R_ = R*T[i];\n      __int128 L_ = L*T[i];\n      if(R_ >= 0) R_ += T[i]-1;\n      if(L_ <= 0) L_ -= T[i]-1;\n      R_ += S[i];\n      L_ += S[i];\n      if(R_ < X[i]) R = R_;\n      else if(R < X[i]) R = X[i];\n      if(L_ < X[i]) L = L_;\n      else if(L < X[i]) L = X[i];\n    }\n\n    R = min<__int128>(R, LLONG_MAX);\n    L = max<__int128>(L, LLONG_MIN+1);\n    //cerr << L << \" \" << R << endl;\n  }\n  //cerr << L << \" \" << R << endl;\n  int ans = 0;\n  for(auto a : A){\n    if(a >= L and a <= R)\n      ++ans;\n  }\n  cout << ans << endl;\n}\n\n\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\n#define rep(i,n) repi(i,0,n)\n#define repi(i,a,b) for(int i=(int)(a);i<(int)(b);++i)\n#define double long double\n\n\n#define ll long long\nusing box = vector<ll>;\n\n\nll check(ll v1, box& q, box& x, box& s, box& t)\n{\n    int Q = q.size();\n    ll v = v1;\n    rep(i, Q)\n    {\n        if(q[i] == 1)\n        {\n            if(v >= x[i])\n            {\n                v = t[i] * (v + s[i]);\n            }\n        }\n        else\n        {\n            if(v <= x[i])\n            {\n                v = (v - s[i]) / t[i]; \n            }\n        }\n        //cout << v << endl;\n    }\n    return v;\n}\nvoid solve()\n{\n    ll N, Q, L, R;\n    cin >> N >> Q >> L >> R;\n    vector<ll> A(N);\n    rep(i, N) cin >> A[i];\n    sort(A.begin(), A.end());\n    vector<ll> q(Q);\n    vector<ll> x(Q);\n    vector<ll> s(Q);\n    vector<ll> t(Q);\n    rep(i, Q)\n    {\n        cin >> q[i] >> x[i] >> s[i] >> t[i];\n    }\n    //L以上となる最初の頂点\n    int ok = N;\n    int ng = -1;\n    while(abs(ok - ng) > 1)\n    {\n        int mid = (ok + ng) / 2;\n        if(check(A[mid], q, x, s, t) >= L)\n        {\n            ok = mid;\n        }\n        else{\n            ng = mid;\n        }\n    }\n    //cout << ok << \" \" << ng << endl;\n\n    //R以下となる最大の頂点\n    int rok = -1;\n    int rng = N;\n    while(abs(rok - rng) > 1)\n    {\n        int mid = (rok + rng) / 2;\n        if(check(A[mid], q, x, s, t) <= R)\n        {\n            rok = mid;\n        }\n        else{\n            rng = mid;\n        }\n    }\n    //cout << rok << \" \" << rng << endl;\n\n    cout << (max(rok - ok + 1, 0)) << endl;\n\n    // rep(i, N){\n    //     cout << A[i] << \" \" << (check(A[i], q, x, s, t)) << endl;\n    // }\n\n}\n\nint main()\n{\n    cin.tie(0);\n    ios::sync_with_stdio(false);\n    solve();\n    return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n#define INF 1e9\n#define llINF 1e18\n#define MOD 1000000007\n#define pb push_back\n#define mp make_pair \n#define F first\n#define S second\n#define ll long long\n#define ull unsigned long long\n#define vi vector<ll>\n#define vvi vector<vi>\n#define DBG_N(hoge) cerr<<\" \"<<(hoge)<<endl;\n#define DBG cerr<<\"!\"<<endl;\n#define BITLE(n) (1LL<<((ll)n))\n#define BITCNT(n) (__builtin_popcountll(n))\n#define SUBS(s,f,t) ((s).substr((f)-1,(t)-(f)+1))\n#define ALL(a) (a).begin(),(a).end()\nusing namespace std;\nstruct Q{\n  ll q,x,s,t; \n};\nvi A;\nvector<Q> query;\nll n,q,l,r;\nll calc(ll num){\n  for(int i=0;i<q;i++){\n    if(query[i].q==1){\n      if(num>=query[i].x){\n\tnum+=query[i].s;\n\tnum*=query[i].t;\n      }\n    }else{\n      if(num<=query[i].x){\n\tnum-=query[i].s;\n\tnum/=query[i].t;\n      }\n    }\n  }\n  return num;\n}\nbool check(ll mid){\n  return calc(A[mid])>=l;\n}\nbool check2(ll mid){\n  return calc(A[mid])<=r;\n}\nint main(){\n  cin.tie(0);\n  ios::sync_with_stdio(false);\n  cin>>n>>q>>l>>r;\n  A.resize(n);\n  for(auto &a:A)cin>>a;\n  sort(ALL(A));\n  query.resize(q);\n  for(auto &a:query){\n    cin>>a.q>>a.x>>a.s>>a.t;\n  }\n  ll le=-1,ri=n-1;\n  while(ri-le>1){\n    ll mid=(ri+le)/2;\n    if(check(mid)){\n      ri=mid;\n    }else{\n      le=mid;\n    }\n  }\n  ll le2=0,ri2=n;\n  while(ri2-le2>1){\n    ll mid=(ri2+le2)/2;\n    if(check2(mid)){\n      le2=mid;\n    }else{\n      ri2=mid;\n    }\n  }\n  cout<<max(0LL,le2-ri+1)<<endl;\n  return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\n\nusing Int = long long;\nusing ll = long long;\n\ntemplate<typename T1,typename T2> inline void chmin(T1 &a,T2 b){if(a>b) a=b;};\ntemplate<typename T1,typename T2> inline void chmax(T1 &a,T2 b){if(a<b) a=b;};\n\ntemplate<typename T> void drop(T x){cout<<x<<endl;exit(0);}\n\n\nsigned main(){\n  cin.tie(0);\n  ios::sync_with_stdio(0);\n\n  Int n,q,l,r;\n  cin>>n>>q>>l>>r;\n  vector<Int> as(n);\n  for(Int i=0;i<n;i++) cin>>as[i];\n\n  vector<Int> qs(q),xs(q),ss(q),ts(q);\n  for(Int i=0;i<q;i++) cin>>qs[i]>>xs[i]>>ss[i]>>ts[i];\n\n  sort(as.begin(),as.end());\n\n  // number of elements whose value is no more than d\n  auto calc=\n    [&](Int d)->Int{\n      auto check=\n        [&](Int a)->Int{\n          for(Int i=0;i<q;i++){\n            if(qs[i]==1){\n              if(a>=xs[i]) a=ts[i]*(a+ss[i]);\n            }else{\n              if(a<=xs[i]) a=(a-ss[i])/ts[i];\n            }\n          }\n          return a<=d;\n        };\n      Int L=-1,R=n;\n      while(L+1<R){\n        Int M=(L+R)>>1;\n        if(check(as[M])) L=M;\n        else R=M;\n      }\n      return R;\n    };\n  Int ans=calc(r)-(l==LLONG_MIN?0:calc(l-1));\n  cout<<ans<<endl;\n  return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<iostream>\n#include<algorithm>\n#include<vector>\nusing namespace std;\ntypedef long long ll;\n#define mod 1000000007\nll N,Q,L,R;\nll a[200010];\nll q[200010],x[200010],s[200010],t[200010];\nll solve(ll i){\n    ll res=a[i];\n    for(int i=0;i<Q;i++){\n\tif(q[i]==1){\n\t    if(res>=x[i]){\n\t\tres=(res+s[i])*t[i];\n\t    }\n\t}\n\tif(q[i]==2){\n\t    if(res<=x[i]){\n\t\tres=(res-s[i])/t[i];\n\t    }\n\t}\n    }\n    return res;\n}\nint main(){\n  cin>>N>>Q>>L>>R;\n  for(int i=0;i<N;i++)cin>>a[i];\n  sort(a,a+N);\n  for(int i=0;i<Q;i++){\n      cin>>q[i]>>x[i]>>s[i]>>t[i];\n  }\n  ll l,r,m;\n  l=-1,r=N;\n  while(l<r-1){\n      m=(l+r)>>1;\n      if(solve(m)>=L)r=m;\n      else l=m;\n  }\n  ll vl=r;\n  l=-1,r=N;\n  while(l<r-1){\n      m=(l+r)>>1;\n      if(solve(m)<=R)l=m;\n      else r=m;\n  }\n  ll vr=l;\n  cout<<max(0LL,vr-vl+1)<<endl;\n  return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\nusing namespace std;\ntypedef long long ll;\nll N, Q, L, R;\nll A[200500];\nll q[205000], x[200500], s[200050], t[200050];\n\nll f(ll now) {\n    for(int i = 1; i <= Q; i++) {\n        if(q[i] == 1) {\n            if(now >= x[i]) {\n                now = t[i] * (now + s[i]);\n            }\n        } else {\n            if(now <= x[i]) {\n                now = (now - s[i]) / t[i];\n            }\n        }\n    }\n    return now;\n}\n\nint main() {\n    cin >> N >> Q >> L >> R;\n    for(int i = 1; i <= N; i++) cin >> A[i];\n    for(int i = 1; i <= Q; i++) {\n        cin >> q[i] >> x[i] >> s[i] >> t[i];\n    }\n    ll overok = 1e9+1;\n    ll overng = -1e9-1;\n    ll underok = -1e9-1;\n    ll underng = 1e9+1;\n    while(overok - overng > 1) {\n        ll mid = (overok + overng) / 2;\n        ll tmp = f(mid);\n        if(tmp > R) overok = mid;\n        else overng = mid;\n    }\n    while(underng - underok > 1) {\n        ll mid = (underok + underng) / 2;\n        ll tmp = f(mid);\n        if(tmp < L) underok = mid;\n        else underng = mid;\n    }\n    //cerr << overok << \" \" << underok << endl;\n//    cerr << f(overok) << \" \" << f(overng) << endl;\n//    cerr << f(underok) << \" \" << f(underng) << endl;\n    ll ans = 0;\n    for(int i = 1; i <= N; i++) {\n        if(A[i] < overok && A[i] > underok) {\n            ans++;\n            //cerr << i << endl;\n        }\n        //cerr << f(A[i]) << endl;\n    }\n    cout << ans << endl;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include <bits/stdc++.h>\nusing namespace std;\n\nint64_t N, Q, L, R, A[200000], D[200000], X[200000], S[200000], T[200000];\n\nint64_t calc(int64_t v){\n    for(int i=0; i<Q; i++){\n        if(D[i] == 1 && X[i] <= v) v = T[i]*(v+S[i]);\n        if(D[i] == 2 && v <= X[i]) v = (v-S[i])/T[i];\n    }\n    return v;\n}\n\nint main(){\n    cin >> N >> Q >> L >> R;\n    for(int i=0; i<N; i++) cin >> A[i];\n    for(int i=0; i<Q; i++) cin >> D[i] >> X[i] >> S[i] >> T[i];\n\n    int64_t mx = *max_element(A, A+N), mn = *min_element(A, A+N);\n    int64_t rok = mn-1, rng = mx+1;\n    while(rng-rok>1){\n        int64_t mid = (rng+rok)/2;\n        (calc(mid) <= R ? rok : rng) = mid;\n    }\n    int64_t lng = mn-1, lok = mx+1;\n    while(lok-lng>1){\n        int64_t mid = (lng+lok)/2;\n        (calc(mid) >= L ? lok : lng) = mid;\n    }\n    int ans = 0;\n    for(int i=0; i<N; i++) if(lok <= A[i] && A[i] <= rok) ans++;\n    cout << ans << endl;\n    return 0;\n}\n\n"
  },
  {
    "language": "C++",
    "code": "#include<bits/stdc++.h>\n#define rep(i,a,b) for(int i=(a);i<=(b);i++)\n#define per(i,a,b) for(int i=(a);i>=(b);i--)\n#define REP(i,n) for(int i=0;i<(n);i++)\n#define fi first\n#define se second\n#define pb push_back\n#define mp make_pair\nusing namespace std;\ntypedef pair<int,int> pii;\ntypedef vector<int> vi;\ntypedef long long ll;\n\ntemplate<class T> void read(T &x){\n\tint f=0; x=0; char ch=getchar();\n\tfor(;!isdigit(ch);ch=getchar()) f|=(ch=='-');\n\tfor(;isdigit(ch);ch=getchar()) x=x*10+ch-'0';\n\tif(f) x=-x;\n}\n\nconst int N=200005;\nll a[N],x[N],s[N],t[N],L,R;\nint op[N],n,Q;\n\nll Div(ll a,ll b){\n\tif(a>=0) return a/b;\n\treturn -((-a)/b);\n}\n\nll calc(ll a){\n\trep(i,1,Q){\n\t\tif(op[i]==1&&a>=x[i]){\n\t\t\ta=t[i]*(a+s[i]);\n\t\t}\n\t\tif(op[i]==2&&a<=x[i]){\n\t\t\ta=Div(a-s[i],t[i]);\n\t\t}\n\t}\n\treturn a;\n}\n\nint solveL(){\n\tint l=1,r=n+1,mi;\n\twhile(l<r){\n\t\tmi=(l+r)>>1;\n\t\tif(calc(a[mi])>=L) r=mi;\n\t\telse l=mi+1;\n\t}\n\treturn l;\n}\n\nint solveR(){\n\tint l=0,r=n,mi;\n\twhile(l<r){\n\t\tmi=(l+r+1)>>1;\n\t\tif(calc(a[mi])<=R) l=mi;\n\t\telse r=mi-1;\n\t}\n\treturn l;\n}\n\nint main(){\n\tread(n),read(Q);\n\tread(L),read(R);\n\trep(i,1,n){\n\t\tread(a[i]);\n\t}\n\trep(i,1,Q){\n\t\tread(op[i]),read(x[i]);\n\t\tread(s[i]),read(t[i]);\n\t}\n\tsort(a+1,a+n+1);\n\tint ansL=solveL();\n\tint ansR=solveR();\n\tcout<<max(0,ansR-ansL+1)<<endl;\n\treturn 0;\n}\n"
  },
  {
    "language": "C++",
    "code": "#include<iostream>\n#include<algorithm>\n#include<vector>\n#include<cstdio>\nusing namespace std;\nint N,Q;\nlong long L,R;\nlong long A[2<<17],q[2<<17],x[2<<17],s[2<<17],t[2<<17];\nint f(long long X)\n{\n    int l=-1,r=N;\n    while(r-l>1)\n    {\n        int m=(l+r)/2;\n        long long now=A[m];\n        for(int i=0;i<Q;i++)\n        {\n            if(q[i]==1&&now>=x[i])\n            {\n                now=t[i]*(now+s[i]);\n            }\n            else if(q[i]==2&&now<=x[i])\n            {\n                now=(now-s[i])/t[i];\n            }\n        }\n        if(now>=X)r=m;\n        else l=m;\n    }\n    return N-l-1;\n}\nint main()\n{\n    cin>>N>>Q>>L>>R;\n    for(int i=0;i<N;i++)scanf(\"%lld\",&A[i]);\n    sort(A,A+N);\n    for(int i=0;i<Q;i++)scanf(\"%lld%lld%lld%lld\",&q[i],&x[i],&s[i],&t[i]);\n    printf(\"%d\\n\",f(L)-(R==(1uLL<<63)-1?0:f(R+1)));\n}\n\n"
  },
  {
    "language": "D",
    "code": "import std.stdio, std.array, std.string, std.conv, std.algorithm;\nimport std.typecons, std.range, std.random, std.math, std.container;\nimport std.numeric, std.bigint, core.bitop, core.stdc.stdio;\n\nvoid main() {\n    auto s = readln.split.map!(to!long);\n    auto N = s[0].to!int;\n    auto Q = s[1].to!int;\n    auto L = s[2];\n    auto R = s[3];\n    auto A = readln.split.map!(to!long).array;\n    auto queries = Q.iota.map!(_ => readln.split.map!(to!long).array).array;\n    A.sort();\n\n    long f(int idx) {\n        long a = A[idx];\n        foreach (q; queries) {\n            auto type = q[0];\n            auto x = q[1];\n            auto y = q[2];\n            auto z = q[3];\n            if (type == 1 && a >= x) {\n                a = z * (a + y);\n            } else if (type == 2 && a <= x) {\n                a = (a - y) / z;\n            }\n        }\n        return a;\n    }\n\n    int ansL, ansR;\n\n    {\n        int hi = N;\n        int lo = -1;\n        while (hi - lo > 1) {\n            int mid = (hi + lo) / 2;\n            if (f(mid) >= L) {\n                hi = mid;\n            } else {\n                lo = mid;\n            }\n        }\n        ansL = hi;\n    }\n\n    {\n        int hi = N;\n        int lo = -1;\n        while (hi - lo > 1) {\n            int mid = (hi + lo) / 2;\n            if (f(mid) <= R) {\n                lo = mid;\n            } else {\n                hi = mid;\n            }\n        }\n        ansR = lo;\n    }\n\n    if (f(N-1) < L || f(0) > R) {\n        writeln(0);\n    } else {\n        writeln(ansR - ansL+ 1);\n    }\n}\n\n"
  },
  {
    "language": "Python",
    "code": "import bisect\nn,Q,L,R = map(int,input().split())\na = list(map(int,input().split()))\na.sort()\np = []\nfor i in range(Q):\n    p.append(tuple(map(int,input().split())))\n\n\ndef f(z):\n    for q,x,s,t in p:\n        if q == 1:\n            if z >= x:\n                z = t*(z+s)\n        else:\n            if z <= x:\n                if z-s < 0:\n                    z = -(abs(z-s)//t)\n                else:\n                    z = (z-s)//t\n\n    return z\n\n\nng = pow(2,63)\nok = -ng\n\nfor i in range(100):\n    mid = (ok+ng)//2\n    if f(mid) <= R:\n        ok = mid\n    else:\n        ng = mid\n\nright = ok        \n\nok = pow(2,63)\nng = -ok\n        \nfor i in range(100):\n    mid = (ok+ng)//2\n    if f(mid) >= L:\n        ok = mid\n    else:\n        ng = mid\nleft = ok\n\nk1 = bisect.bisect_left(a,left)\nk2 = bisect.bisect_right(a,right)\n\n\nprint(k2-k1)\n\n"
  },
  {
    "language": "Python",
    "code": "#!usr/bin/env python3\nfrom collections import defaultdict,deque\nfrom heapq import heappush, heappop\nimport sys\nimport math\nimport bisect\nimport random\ndef LI(): return [int(x) for x in sys.stdin.readline().split()]\ndef I(): return int(sys.stdin.readline())\ndef LS():return [list(x) for x in sys.stdin.readline().split()]\ndef S():\n    res = list(sys.stdin.readline())\n    if res[-1] == \"\\n\":\n        return res[:-1]\n    return res\ndef IR(n):\n    return [I() for i in range(n)]\ndef LIR(n):\n    return [LI() for i in range(n)]\ndef SR(n):\n    return [S() for i in range(n)]\ndef LSR(n):\n    return [LS() for i in range(n)]\n\nsys.setrecursionlimit(1000000)\nmod = 1000000007\n\n\n#A\ndef A():\n    n = I()\n    a = LI()\n    s = sum([i%2 for i in a])\n    if s in (0,n):\n        print(0)\n    else:\n        print(n-2+(s%2))\n    return\n\n#B\ndef B():\n    n,Q,L,R = LI()\n    a = LI()\n    a.sort()\n    query = LIR(Q)\n    l = -1\n    r = n\n    while r-l > 1:\n        m = (l+r)>>1\n        am = a[m]\n        for q,x,s,t in query:\n            if q == 1:\n                if am < x:\n                    continue\n                am += s\n                am *= t\n            else:\n                if am > x:\n                    continue\n                am -= s\n                if am < 0:\n                    am = -((-am)//t)\n                else:\n                    am //= t\n        if am < L:\n            l = m\n        else:\n            r = m\n    left = r\n    l = 0\n    r = n\n    while r-l > 1:\n        m = (l+r)>>1\n        am = a[m]\n        for q,x,s,t in query:\n            if q == 1:\n                if am < x:\n                    continue\n                am += s\n                am *= t\n            else:\n                if am > x:\n                    continue\n                am -= s\n                if am < 0:\n                    am = -((-am)//t)\n                else:\n                    am //= t\n        if am <= R:\n            l = m\n        else:\n            r = m\n    print(r-left)\n    return\n\n#C\ndef C():\n    n = I()\n\n    return\n\n#D\ndef D():\n    n = I()\n\n    return\n\n#E\ndef E():\n    n = I()\n\n    return\n\n#F\ndef F():\n    n = I()\n\n    return\n\n#G\ndef G():\n    n = I()\n\n    return\n\n#H\ndef H():\n    n = I()\n\n    return\n\n#I\ndef I_():\n    n = I()\n\n    return\n\n#J\ndef J():\n    n = I()\n\n    return\n\n#Solve\nif __name__ == \"__main__\":\n    B()\n\n"
  }
]